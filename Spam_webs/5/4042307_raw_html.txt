<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
 <head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
  <meta content="index,nofollow" name="robots"/>
  <title>
   MakeALiveCD/DVD/BootableFlashFromHarddiskInstall - Community Help Wiki
  </title>
  <script src="/moin_static193/common/js/common.js" type="text/javascript">
  </script>
  <script type="text/javascript">
   &lt;!--
var search_hint = "Search";
//--&gt;
  </script>
  <link charset="utf-8" href="/moin_static193/light/css/common.css" media="all" rel="stylesheet" type="text/css"/>
  <link charset="utf-8" href="/moin_static193/light/css/screen.css" media="screen" rel="stylesheet" type="text/css"/>
  <link charset="utf-8" href="/moin_static193/light/css/print.css" media="print" rel="stylesheet" type="text/css"/>
  <link charset="utf-8" href="/moin_static193/light/css/projection.css" media="projection" rel="stylesheet" type="text/css"/>
  <!-- css only for MS IE6/IE7 browsers -->
  <!--[if lt IE 8]&gt;
   &lt;link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static193/light/css/msie.css"&gt;
&lt;![endif]-->
  <link href="/community/CommunityHelpWiki" rel="Start"/>
  <link href="/community/MakeALiveCD/DVD/BootableFlashFromHarddiskInstall?action=raw" rel="Alternate" title="Wiki Markup"/>
  <link href="/community/MakeALiveCD/DVD/BootableFlashFromHarddiskInstall?action=print" media="print" rel="Alternate" title="Print View"/>
  <link href="/community/FindPage" rel="Search"/>
  <link href="/community/TitleIndex" rel="Index"/>
  <link href="/community/WordIndex" rel="Glossary"/>
  <link href="/community/HelpOnFormatting" rel="Help"/>
 </head>
 <body dir="ltr" lang="en">
  <div id="leftbanner">
  </div>
  <div id="rightbanner">
  </div>
  <div id="container">
   <div id="container-inner">
    <div id="mothership">
     <ul>
      <li>
       <a href="http://www.ubuntu.com/partners">
        Partners
       </a>
      </li>
      <li>
       <a href="http://www.ubuntu.com/support">
        Support
       </a>
      </li>
      <li>
       <a href="http://www.ubuntu.com/community">
        Community
       </a>
      </li>
      <li>
       <a href="http://www.ubuntu.com">
        Ubuntu.com
       </a>
      </li>
     </ul>
    </div>
    <div id="header">
     <h1 id="ubuntu-header">
      <a href="https://help.ubuntu.com/">
       Ubuntu Documentation
      </a>
     </h1>
     <ul id="main-menu">
      <li>
       <a href="https://help.ubuntu.com/">
        Official Documentation
       </a>
      </li>
      <li>
       <a class="main-menu-item current" href="https://help.ubuntu.com/community/CommunityHelpWiki">
        Community Help Wiki
       </a>
      </li>
      <li>
       <a href="http://community.ubuntu.com/contribute/documentation/">
        Contribute
       </a>
      </li>
     </ul>
    </div>
    <div id="menu-search">
     <div id="subheader">
      <div class="subheader-menu">
       <div id="second-nav">
        <ul id="username">
         <li>
          <a class="nbinfo" href="/community/MakeALiveCD/DVD/BootableFlashFromHarddiskInstall?action=info" rel="nofollow">
           Page History
          </a>
         </li>
         <li>
          <a href="/community/MakeALiveCD/DVD/BootableFlashFromHarddiskInstall?action=login&amp;login=1" id="login" rel="nofollow">
           Login to edit
          </a>
         </li>
        </ul>
       </div>
       <div id="user-info">
       </div>
      </div>
     </div>
     <div id="search-box">
      <noscript>
       <form action="http://www.google.com/cse" id="cse-search-box">
        <div>
         <input name="cx" type="hidden" value="003883529982892832976:e2vwumte3fq"/>
         <input name="ie" type="hidden" value="UTF-8"/>
         <input name="q" size="21" type="text"/>
         <input name="sa" type="submit" value="Search"/>
        </div>
       </form>
      </noscript>
      <script>
       document.write('&lt;form action="https://help.ubuntu.com/search.html" id="cse-search-box"&gt;');
 document.write('  &lt;div&gt;');
 document.write('    &lt;input type="hidden" name="cof" value="FORID:9" /&gt;');
 document.write('    &lt;input type="hidden" name="cx" value="003883529982892832976:e2vwumte3fq" /&gt;');
 document.write('    &lt;input type="hidden" name="ie" value="UTF-8" /&gt;');
 document.write('    &lt;input type="text" name="q" size="21" /&gt;');
 document.write('    &lt;input type="submit" name="sa" value="Search" /&gt;');
 document.write('  &lt;/div&gt;');
 document.write('&lt;/form&gt;');
      </script>
     </div>
    </div>
    <div id="title">
     <h1>
      <span id="pagelocation">
       <span class="pagepath">
        <a class="nonexistent" href="/community/MakeALiveCD">
         MakeALiveCD
        </a>
        <span class="sep">
         /
        </span>
        <a class="nonexistent" href="/community/MakeALiveCD/DVD">
         DVD
        </a>
       </span>
       <span class="sep">
        /
       </span>
       <a class="backlink" href="/community/MakeALiveCD/DVD/BootableFlashFromHarddiskInstall?action=fullsearch&amp;value=linkto%3A%22MakeALiveCD%2FDVD%2FBootableFlashFromHarddiskInstall%22&amp;context=180" rel="nofollow" title="Click to do a full-text search for this title">
        BootableFlashFromHarddiskInstall
       </a>
      </span>
     </h1>
    </div>
    <div id="cwt-nav3">
     <hr class="clear"/>
    </div>
    <div class="clearfix content-area" id="cwt-content">
     <div dir="ltr" id="page" lang="en">
      <div dir="ltr" id="content" lang="en">
       <span class="anchor" id="top">
       </span>
       <span class="anchor" id="line-1">
       </span>
       <span class="anchor" id="line-2">
       </span>
       <span class="anchor" id="line-3">
       </span>
       <div>
        <table style="float:right;  font-size: 0.9em;  width:40%;  background:#F1F1ED;  margin: 0 0 1em 1em;">
         <tbody>
          <tr>
           <td style="padding:0.5em;">
            <p class="line891">
            </p>
            <div class="table-of-contents">
             <p class="table-of-contents-heading">
              Contents
             </p>
             <ol>
              <li>
               <a href="#Introduction">
                Introduction
               </a>
              </li>
              <li>
               <a href="#Background_on_live_CD.2FDVD">
                Background on live CD/DVD
               </a>
              </li>
              <li>
               <a href="#What_are_these_differences.3F">
                What are these differences?
               </a>
              </li>
              <li>
               <a href="#How_does_initramfs_work.3F">
                How does initramfs work?
               </a>
              </li>
              <li>
               <a href="#How_is_initramfs_created.3F">
                How is initramfs created?
               </a>
              </li>
              <li>
               <a href="#The_live_CD.2FDVD_structure">
                The live CD/DVD structure
               </a>
              </li>
              <li>
               <a href="#Outline_of_the_steps">
                Outline of the steps
               </a>
              </li>
              <li>
               <a href="#Conventions_used_in_this_HOWTO">
                Conventions used in this HOWTO
               </a>
              </li>
              <li>
               <a href="#Preparing_the_environment">
                Preparing the environment
               </a>
              </li>
              <li>
               <a href="#Copy_your_installation_into_the_new_filesystem">
                Copy your installation into the new filesystem
               </a>
              </li>
              <li>
               <a href="#Chroot_into_the_new_system_and_modify_it">
                Chroot into the new system and modify it
               </a>
              </li>
              <li>
               <a href="#Prepare_The_CD_directory_tree">
                Prepare The CD directory tree
               </a>
              </li>
              <li>
               <a href="#Build_the_CD.2FDVD">
                Build the CD/DVD
               </a>
              </li>
              <li>
               <a href="#Final_Notes">
                Final Notes
               </a>
              </li>
              <li>
               <a href="#Building_the_live_media_form_scratch_using_debootstrap">
                Building the live media form scratch using debootstrap
               </a>
              </li>
              <li>
               <a href="#Appendix_2._How_to_Make_bootable_USB_flash">
                Appendix 2. How to Make bootable USB flash
               </a>
              </li>
             </ol>
            </div>
           </td>
          </tr>
         </tbody>
        </table>
       </div>
       <span class="anchor" id="line-4">
       </span>
       <span class="anchor" id="line-5">
       </span>
       <p class="line862">
        Discussion of this wiki can be found
        <a class="http" href="http://ubuntuforums.org/showthread.php?p=12062094#post12062094">
         here
        </a>
        <span class="anchor" id="line-6">
        </span>
        <span class="anchor" id="line-7">
        </span>
       </p>
       <p class="line867">
       </p>
       <h1 id="Introduction">
        Introduction
       </h1>
       <span class="anchor" id="line-8">
       </span>
       <span class="anchor" id="line-9">
       </span>
       <ul>
        <li>
         <p class="line862">
          This guide is updated to use grub2 instead of grub-legacy
          <em>
           <span class="anchor" id="line-10">
           </span>
           <span class="anchor" id="line-11">
           </span>
           <span class="anchor" id="line-12">
           </span>
          </em>
         </p>
        </li>
        <li class="gap">
         <p class="line862">
          Appendix 2 shows how to make a bootable flash disk instead of a live CD.
          <span class="anchor" id="line-13">
          </span>
          <span class="anchor" id="line-14">
          </span>
         </p>
        </li>
       </ul>
       <p class="line874">
        This HOWTO is about making a live CD/DVD from the main system on your hard drive.
        <span class="anchor" id="line-15">
        </span>
        <span class="anchor" id="line-16">
        </span>
       </p>
       <p class="line874">
        This might be desired if you have customized your system and want to have it on CD.
        <span class="anchor" id="line-17">
        </span>
        <span class="anchor" id="line-18">
        </span>
       </p>
       <ul>
        <li style="list-style-type:none">
         Another approach that will be discussed here is building your live CD/DVD from scratch. This will be done by building a new system using debootstrap. This is usefull if you want to build a clean live CD, or if you want to build a minimal rescue cd. (Consult Appendix.1 for more details about building a CD from scratch).
         <span class="anchor" id="line-19">
         </span>
         <span class="anchor" id="line-20">
         </span>
         The live CD is usually created with a filesystem called squashfs. Squashfs is read only compressed filesystem that allow us to squeeze our system into a single CD. Note that your system has to be about 2GB (this might need some trial an error) to produce a compressed image that fits on the CD. Otherwise, you will have to use a DVD, or you can use a flash disk as pointed out in Appendix. 2.
         <span class="anchor" id="line-21">
         </span>
         <span class="anchor" id="line-22">
         </span>
        </li>
       </ul>
       <p class="line867">
       </p>
       <h1 id="Background_on_live_CD.2FDVD">
        Background on live CD/DVD
       </h1>
       <span class="anchor" id="line-23">
       </span>
       <span class="anchor" id="line-24">
       </span>
       <p class="line867">
        <strong>
         Note: This section is a clarification of how live CD works. You don't have to read it. You can skip it if you want.
        </strong>
        <span class="anchor" id="line-25">
        </span>
        <span class="anchor" id="line-26">
        </span>
       </p>
       <ul>
        <li style="list-style-type:none">
         <p class="line862">
          A live CD/DVD is basically a normal linux installation just like an ordinary harddrive installation. However, simply copying the harddirve installation over to a CD/DVD is not enough to produce a working system.
          <em>
           Why?
          </em>
          because there are still minor differences between a live CD/DVD and on ordinary harddrive installation. So in addition to copying our harddirve installation to the CD/DVD we must address those differences as well.
          <span class="anchor" id="line-27">
          </span>
          <span class="anchor" id="line-28">
          </span>
         </p>
        </li>
       </ul>
       <p class="line867">
       </p>
       <h1 id="What_are_these_differences.3F">
        What are these differences?
       </h1>
       <span class="anchor" id="line-29">
       </span>
       <span class="anchor" id="line-30">
       </span>
       <ul>
        <li>
         <p class="line862">
          The CD or DVD is read only media. Linux needs to have write access to certain parts of the system to be able to operate properly (like "/dev" "/proc" "/var" "/tmp"). There are a lot of approaches to address this problem. All of which utilize the system RAM. Some of these approaches enable write access only to essential directories and files, and hence, they do not allow the user to modify the system or install new packages while in the live CD. Other approaches, like
          <a class="http" href="http://www.filesystems.org/project-unionfs.html">
           aufs2
          </a>
          which is what is used in this guide, allows the user to write to any part of the system. This is done by merging part of the RAM with the read-only filesystem of the live CD/DVD and making the look like one filesystem that have read-write access. Aufs2 has to be mounted at boot in a certain manner.
          <span class="anchor" id="line-31">
          </span>
          <span class="anchor" id="line-32">
          </span>
          <span class="anchor" id="line-33">
          </span>
         </p>
        </li>
        <li class="gap">
         With the harddrive installation the location of the root filesystem is fixed. So it is passed to the kernel at boot time using the root=/dev/... parameter. With a live CD/DVD, the location of the root device is not fixed as the user might have multiple cdrom drives, these drives can be ide, scsi ... etc. So for the root filesystem to be mounted, there must be a way to identify the root device, and then we have to load the suitable kernel modules (to be able to access the cdrom controller as well as the CD filesystem). All this has to be done even before we have a root filesystem mounted.
         <span class="anchor" id="line-34">
         </span>
         <span class="anchor" id="line-35">
         </span>
         <span class="anchor" id="line-36">
         </span>
         <span class="anchor" id="line-37">
         </span>
        </li>
        <li class="gap">
         <p class="line862">
          To fit on a CD, the filesystem is usually compressed using
          <a class="http" href="http://squashfs.sourceforge.net/">
           squashfs
          </a>
          . So we need to autodetect the filesystem type. We also need to have the proper modules for mounting it.
          <span class="anchor" id="line-38">
          </span>
          <span class="anchor" id="line-39">
          </span>
          <span class="anchor" id="line-40">
          </span>
          <span class="anchor" id="line-41">
          </span>
          These considerations require special preparation at boot time, some of which must be performed even before mounting the actual filesystem. How can we do this?
          <span class="anchor" id="line-42">
          </span>
          <span class="anchor" id="line-43">
          </span>
          Linux introduced a mechanism that allow for such preparations at boot time before the actual root filesystem is mounted. It is called the initial root filesystem or initramfs. This mechanism is used also in mounting normal harddirve installations, as it adds flexibilty to the boot process.
          <span class="anchor" id="line-44">
          </span>
          <span class="anchor" id="line-45">
          </span>
          <span class="anchor" id="line-46">
          </span>
         </p>
        </li>
       </ul>
       <p class="line867">
        <a class="http" href="http://www.linuxdevices.com/articles/AT4017834659.html">
         initramfs
        </a>
        is virtual filesystem. It is a compressed cpio (cpio is an archive format similar to tar) archive that contains a minimal shell, kernel modules necessary for mounting the root filesystem and number of scripts that perform some tasks at boot time. The most important of these scripts is a script called init located at the root of the initramfs.
        <span class="anchor" id="line-47">
        </span>
        <span class="anchor" id="line-48">
        </span>
       </p>
       <p class="line867">
       </p>
       <h1 id="How_does_initramfs_work.3F">
        How does initramfs work?
       </h1>
       <span class="anchor" id="line-49">
       </span>
       <span class="anchor" id="line-50">
       </span>
       <ul>
        <li style="list-style-type:none">
         The boot loader loads both the kernel and the initramfs into memory and starts the kernel. The kernel then unpacks the initramfs and mount it as initial root filesystem, and then looks for the init program within the initial filesystem, and once it finds it, it executes it and hand the boot process over to it. This init scirpt is responsible for finding the real root filesystem and mounting it. It is also responsible for any special preparations required at boot time.
         <span class="anchor" id="line-51">
         </span>
         <span class="anchor" id="line-52">
         </span>
         So any special operations required for booting the system from live media can be coded into the initramfs boot scripts.
         <span class="anchor" id="line-53">
         </span>
         <span class="anchor" id="line-54">
         </span>
        </li>
       </ul>
       <p class="line867">
       </p>
       <h1 id="How_is_initramfs_created.3F">
        How is initramfs created?
       </h1>
       <span class="anchor" id="line-55">
       </span>
       <span class="anchor" id="line-56">
       </span>
       <ul>
        <li style="list-style-type:none">
         We do not have to create initramfs manually (although it can be done). There are tools for creating and updating initramfs like the command update-initramfs. Moreover, these tools can include custom scripts into the initramfs if they are placed in a certain preset locations (/usr/share/initramfs/scripts). So all we have to do is dump our custom scripts (which will do all the required preparation for booting the live CD/DVD) into these preset locations, and then create a custom initramfs by running update-initramfs.
         <span class="anchor" id="line-57">
         </span>
         <span class="anchor" id="line-58">
         </span>
         We don't even have to write these scripts. Why? becuase there are packages that have scripts tailored for booting form live CDs. One of these packages is called casper (this is the package used in this howto). By installing casper into the system, it places the scripts in there proper locations (where they can be spotted by update-initrfamfs). The only thing we need to do after installing casper is running update-initramfs to create an initramfs suitable for live CD/DVD.
         <span class="anchor" id="line-59">
         </span>
         <span class="anchor" id="line-60">
         </span>
        </li>
       </ul>
       <p class="line867">
       </p>
       <h1 id="The_live_CD.2FDVD_structure">
        The live CD/DVD structure
       </h1>
       <span class="anchor" id="line-61">
       </span>
       <span class="anchor" id="line-62">
       </span>
       <ul>
        <li style="list-style-type:none">
         The directory tree of the live CD/DVD we are going to create is going to look like this:
         <span class="anchor" id="line-63">
         </span>
         <span class="anchor" id="line-64">
         </span>
        </li>
       </ul>
       <p class="line867">
        <span class="anchor" id="line-65">
        </span>
        <span class="anchor" id="line-66">
        </span>
        <span class="anchor" id="line-67">
        </span>
        <span class="anchor" id="line-68">
        </span>
        <span class="anchor" id="line-69">
        </span>
        <span class="anchor" id="line-70">
        </span>
        <span class="anchor" id="line-71">
        </span>
        <span class="anchor" id="line-72">
        </span>
        <span class="anchor" id="line-73">
        </span>
        <span class="anchor" id="line-74">
        </span>
        <span class="anchor" id="line-75">
        </span>
        <span class="anchor" id="line-76">
        </span>
        <span class="anchor" id="line-77">
        </span>
        <span class="anchor" id="line-78">
        </span>
        <span class="anchor" id="line-79">
        </span>
        <span class="anchor" id="line-80">
        </span>
        <span class="anchor" id="line-81">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1">
        </span>
        (CD ROOT)
        <span class="anchor" id="line-2">
        </span>
        |-------+casper
        <span class="anchor" id="line-3">
        </span>
        |       |-------filesystem.${FORMAT}
        <span class="anchor" id="line-4">
        </span>
        |       |-------filesystem.manifest
        <span class="anchor" id="line-5">
        </span>
        |       |-------filesystem.manifest-desktop
        <span class="anchor" id="line-6">
        </span>
        |       |-------vmlinuz |
        <span class="anchor" id="line-7">
        </span>
        |-------initrd.img
        <span class="anchor" id="line-8">
        </span>
        |
        <span class="anchor" id="line-9">
        </span>
        |-------+boot
        <span class="anchor" id="line-10">
        </span>
        |       |--------+grub
        <span class="anchor" id="line-11">
        </span>
        |       |
        <span class="anchor" id="line-12">
        </span>
        |       |        |--------grub.cfg
        <span class="anchor" id="line-13">
        </span>
        |       |
        <span class="anchor" id="line-14">
        </span>
        |-------memtest86+
        <span class="anchor" id="line-15">
        </span>
        |
        <span class="anchor" id="line-16">
        </span>
        |--------md5sum.txt
       </pre>
       <span class="anchor" id="line-82">
       </span>
       <ul>
        <li>
         /casper/filesystem.${FORMAT}: This is the container of the linux filesystem we are going to copy from our harddisk. It is usually a compressed filesystem like squahsfs.
         <span class="anchor" id="line-83">
         </span>
         <span class="anchor" id="line-84">
         </span>
        </li>
        <li class="gap">
         /casper/filesystem.manifest: This file is optional. You only need it if you decide to include the Ubuntu installer in the CD. The purpose of this file will be explained later.
         <span class="anchor" id="line-85">
         </span>
         <span class="anchor" id="line-86">
         </span>
        </li>
        <li class="gap">
         /casper/filesystem.manifest-desktop: This file is optional. You only need it if you decide to include the Ubuntu installer in the CD. The purpose of this file will be explained later.
         <span class="anchor" id="line-87">
         </span>
         <span class="anchor" id="line-88">
         </span>
        </li>
        <li class="gap">
         /casper/vmlinuz: The linux kernel. This is copied form the linux filesystem.
         <span class="anchor" id="line-89">
         </span>
         <span class="anchor" id="line-90">
         </span>
        </li>
        <li class="gap">
         /casper/initrd.img: the initramfs that contain the customizations necessary for the live CD/DVD.
         <span class="anchor" id="line-91">
         </span>
         <span class="anchor" id="line-92">
         </span>
        </li>
        <li class="gap">
         /boot/grub/grub.cfg: File containing boot options for the live CD/DVD.
         <span class="anchor" id="line-93">
         </span>
         <span class="anchor" id="line-94">
         </span>
        </li>
        <li class="gap">
         /boot/memtest86+: Optional file used to test the RAM of the machine form the live CD/DVD.
         <span class="anchor" id="line-95">
         </span>
         <span class="anchor" id="line-96">
         </span>
        </li>
        <li class="gap">
         /md5sum.txt: Optional file containing checksums for all the files in the CD.
         <span class="anchor" id="line-97">
         </span>
         <span class="anchor" id="line-98">
         </span>
         <span class="anchor" id="line-99">
         </span>
        </li>
       </ul>
       <p class="line867">
       </p>
       <h1 id="Outline_of_the_steps">
        Outline of the steps
       </h1>
       <span class="anchor" id="line-100">
       </span>
       <span class="anchor" id="line-101">
       </span>
       <ul>
        <li>
         Prepare Our work environment.
         <span class="anchor" id="line-102">
         </span>
         <span class="anchor" id="line-103">
         </span>
        </li>
        <li class="gap">
         Copy the Source system to the target directory.
         <span class="anchor" id="line-104">
         </span>
         <span class="anchor" id="line-105">
         </span>
        </li>
        <li class="gap">
         Chroot into the new system and make some modifications.
         <span class="anchor" id="line-106">
         </span>
         <span class="anchor" id="line-107">
         </span>
        </li>
        <li class="gap">
         Prepare The CD directory tree.
         <span class="anchor" id="line-108">
         </span>
         <span class="anchor" id="line-109">
         </span>
        </li>
        <li class="gap">
         Build the CD/DVD
         <span class="anchor" id="line-110">
         </span>
         <span class="anchor" id="line-111">
         </span>
         <span class="anchor" id="line-112">
         </span>
         <p class="line891">
          <strong>
           Appendix 1. Building the live media from scratch with Debootstrap:
          </strong>
          <span class="anchor" id="line-113">
          </span>
          <span class="anchor" id="line-114">
          </span>
          <span class="anchor" id="line-115">
          </span>
         </p>
         <p class="line891">
          <strong>
           Appendix 2. How to Boot the ISO from a flash disk:
          </strong>
          <span class="anchor" id="line-116">
          </span>
          <span class="anchor" id="line-117">
          </span>
          <span class="anchor" id="line-118">
          </span>
          <span class="anchor" id="line-119">
          </span>
         </p>
        </li>
       </ul>
       <p class="line867">
       </p>
       <h1 id="Conventions_used_in_this_HOWTO">
        Conventions used in this HOWTO
       </h1>
       <span class="anchor" id="line-120">
       </span>
       <span class="anchor" id="line-121">
       </span>
       <span class="anchor" id="line-122">
       </span>
       <ul>
        <li>
         I will use gedit as my default text editor. Replace gedit with your favorite text editor.
         <span class="anchor" id="line-123">
         </span>
         <span class="anchor" id="line-124">
         </span>
        </li>
        <li class="gap">
         Commands performed within a chroot will be marked by (chroot).
         <span class="anchor" id="line-125">
         </span>
         <span class="anchor" id="line-126">
         </span>
        </li>
        <li class="gap">
         Optional arguments or steps will be marked as (optional).
         <span class="anchor" id="line-127">
         </span>
         <span class="anchor" id="line-128">
         </span>
         <span class="anchor" id="line-129">
         </span>
        </li>
       </ul>
       <p class="line867">
       </p>
       <h1 id="Preparing_the_environment">
        Preparing the environment
       </h1>
       <span class="anchor" id="line-130">
       </span>
       <span class="anchor" id="line-131">
       </span>
       <ol type="1">
        <li>
         Set some variables
         <span class="anchor" id="line-132">
         </span>
         <span class="anchor" id="line-133">
         </span>
        </li>
       </ol>
       <p class="line867">
        <span class="anchor" id="line-134">
        </span>
        <span class="anchor" id="line-135">
        </span>
        <span class="anchor" id="line-136">
        </span>
        <span class="anchor" id="line-137">
        </span>
        <span class="anchor" id="line-138">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-1">
        </span>
        export WORK=~/work
        <span class="anchor" id="line-2-1">
        </span>
        export CD=~/cd
        <span class="anchor" id="line-3-1">
        </span>
        export FORMAT=squashfs
        <span class="anchor" id="line-4-1">
        </span>
        export FS_DIR=casper
       </pre>
       <span class="anchor" id="line-139">
       </span>
       <span class="anchor" id="line-140">
       </span>
       <span class="anchor" id="line-141">
       </span>
       <ul>
        <li style="list-style-type:none">
         The WORK Directory is where our temporary files and mount point will reside.
         <span class="anchor" id="line-142">
         </span>
         The CD is the location of the CD tree.
         <span class="anchor" id="line-143">
         </span>
         FORMAT is the filesystem type. We you are going to use a compressed squashfs.
         <span class="anchor" id="line-144">
         </span>
         FS_DIR is the location of the actual filesystem image within the cd tree.
         <span class="anchor" id="line-145">
         </span>
         <span class="anchor" id="line-146">
         </span>
         <ol type="2">
          <li>
           Create the CD and the WORK directory structure:
           <span class="anchor" id="line-147">
           </span>
           <span class="anchor" id="line-148">
           </span>
           <span class="anchor" id="line-149">
           </span>
          </li>
         </ol>
        </li>
       </ul>
       <p class="line867">
        <span class="anchor" id="line-150">
        </span>
        <span class="anchor" id="line-151">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-2">
        </span>
        sudo mkdir -p ${CD}/{${FS_DIR},boot/grub} ${WORK}/rootfs
       </pre>
       <span class="anchor" id="line-152">
       </span>
       <span class="anchor" id="line-153">
       </span>
       <span class="anchor" id="line-154">
       </span>
       <ol type="3">
        <li>
         Install some packages on your current system:
         <span class="anchor" id="line-155">
         </span>
         <span class="anchor" id="line-156">
         </span>
         <span class="anchor" id="line-157">
         </span>
        </li>
       </ol>
       <p class="line867">
        <span class="anchor" id="line-158">
        </span>
        <span class="anchor" id="line-159">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-3">
        </span>
        sudo apt-get update
       </pre>
       <span class="anchor" id="line-160">
       </span>
       <span class="anchor" id="line-161">
       </span>
       <p class="line867">
        <span class="anchor" id="line-162">
        </span>
        <span class="anchor" id="line-163">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-4">
        </span>
        sudo apt-get install grub2 xorriso squashfs-tools qemu  (qemu optional)
       </pre>
       <span class="anchor" id="line-164">
       </span>
       <span class="anchor" id="line-165">
       </span>
       <span class="anchor" id="line-166">
       </span>
       <p class="line874">
        qemu is (optional). It is only needed for testing the cd before burning it. It can be substituted with any other virtualization software like virtualbox.
        <span class="anchor" id="line-167">
        </span>
        <span class="anchor" id="line-168">
        </span>
        <span class="anchor" id="line-169">
        </span>
       </p>
       <p class="line867">
       </p>
       <h1 id="Copy_your_installation_into_the_new_filesystem">
        Copy your installation into the new filesystem
       </h1>
       <span class="anchor" id="line-170">
       </span>
       <span class="anchor" id="line-171">
       </span>
       <span class="anchor" id="line-172">
       </span>
       <p class="line867">
        <span class="anchor" id="line-173">
        </span>
        <span class="anchor" id="line-174">
        </span>
        <span class="anchor" id="line-175">
        </span>
        <span class="anchor" id="line-176">
        </span>
        <span class="anchor" id="line-177">
        </span>
        <span class="anchor" id="line-178">
        </span>
        <span class="anchor" id="line-179">
        </span>
        <span class="anchor" id="line-180">
        </span>
        <span class="anchor" id="line-181">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-5">
        </span>
        sudo rsync -av --one-file-system --exclude=/proc/* --exclude=/dev/* \
        <span class="anchor" id="line-2-2">
        </span>
        --exclude=/sys/* --exclude=/tmp/* --exclude=/home/* --exclude=/lost+found \
        <span class="anchor" id="line-3-2">
        </span>
        --exclude=/var/tmp/* --exclude=/boot/grub/* --exclude=/root/* \
        <span class="anchor" id="line-4-2">
        </span>
        --exclude=/var/mail/* --exclude=/var/spool/* --exclude=/media/* \
        <span class="anchor" id="line-5-1">
        </span>
        --exclude=/etc/fstab --exclude=/etc/mtab --exclude=/etc/hosts \
        <span class="anchor" id="line-6-1">
        </span>
        --exclude=/etc/timezone --exclude=/etc/shadow* --exclude=/etc/gshadow* \
        <span class="anchor" id="line-7-1">
        </span>
        --exclude=/etc/X11/xorg.conf* --exclude=/etc/gdm/custom.conf \
        <span class="anchor" id="line-8-1">
        </span>
        --exclude=/etc/lightdm/lightdm.conf --exclude=${WORK}/rootfs / ${WORK}/rootfs
       </pre>
       <span class="anchor" id="line-182">
       </span>
       <span class="anchor" id="line-183">
       </span>
       <span class="anchor" id="line-184">
       </span>
       <ul>
        <li style="list-style-type:none">
         Note: rsync is used instead of cp to take advantage of the --one-file-system and the --exclude options.
         <span class="anchor" id="line-185">
         </span>
         <span class="anchor" id="line-186">
         </span>
         <span class="anchor" id="line-187">
         </span>
         If you have a separate boot partition you will have to copy it using the following command:
         <span class="anchor" id="line-188">
         </span>
         <span class="anchor" id="line-189">
         </span>
        </li>
       </ul>
       <p class="line867">
        <span class="anchor" id="line-190">
        </span>
        <span class="anchor" id="line-191">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-6">
        </span>
        sudo cp -av /boot/* ${WORK}/rootfs/boot
       </pre>
       <span class="anchor" id="line-192">
       </span>
       <span class="anchor" id="line-193">
       </span>
       <p class="line874">
        (Optional) Copy settings in your home dir:
        <span class="anchor" id="line-194">
        </span>
        <span class="anchor" id="line-195">
        </span>
        <span class="anchor" id="line-196">
        </span>
       </p>
       <ul>
        <li style="list-style-type:none">
         If you want to preseve your user account settings which are stored in your home directory, you can copy them to ${WORK}/rootfs/etc/skel/.
         <span class="anchor" id="line-197">
         </span>
         <span class="anchor" id="line-198">
         </span>
         But first we have to define what files we want to copy. For example I am using xcfe4 as my DE, and it stores all it settings in a directory called .config in my home directory, so I am going to add .config to the variable $CONFIG:
         <span class="anchor" id="line-199">
         </span>
        </li>
       </ul>
       <p class="line874">
        (optional)
        <span class="anchor" id="line-200">
        </span>
        <span class="anchor" id="line-201">
        </span>
        <span class="anchor" id="line-202">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-7">
        </span>
        CONFIG='.config .bashrc'
       </pre>
       <span class="anchor" id="line-203">
       </span>
       <span class="anchor" id="line-204">
       </span>
       <p class="line874">
        Now, Copy the CONFIG files using the following command:
        <span class="anchor" id="line-205">
        </span>
        (optional)
        <span class="anchor" id="line-206">
        </span>
        <span class="anchor" id="line-207">
        </span>
        <span class="anchor" id="line-208">
        </span>
        <span class="anchor" id="line-209">
        </span>
        <span class="anchor" id="line-210">
        </span>
        <span class="anchor" id="line-211">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-8">
        </span>
        cd ~ &amp;&amp; for i in $CONFIG
        <span class="anchor" id="line-2-3">
        </span>
        do
        <span class="anchor" id="line-3-3">
        </span>
        sudo cp -rpv --parents $i ${WORK}/rootfs/etc/skel
        <span class="anchor" id="line-4-3">
        </span>
        done
       </pre>
       <span class="anchor" id="line-212">
       </span>
       <span class="anchor" id="line-213">
       </span>
       <p class="line867">
       </p>
       <h1 id="Chroot_into_the_new_system_and_modify_it">
        Chroot into the new system and modify it
       </h1>
       <span class="anchor" id="line-214">
       </span>
       <span class="anchor" id="line-215">
       </span>
       <ol type="1">
        <li>
         Chroot into the copied system after mounting proc and dev:
         <span class="anchor" id="line-216">
         </span>
         <span class="anchor" id="line-217">
         </span>
        </li>
       </ol>
       <p class="line867">
        <span class="anchor" id="line-218">
        </span>
        <span class="anchor" id="line-219">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-9">
        </span>
        sudo mount  --bind /dev/ ${WORK}/rootfs/dev
       </pre>
       <span class="anchor" id="line-220">
       </span>
       <span class="anchor" id="line-221">
       </span>
       <p class="line867">
        <span class="anchor" id="line-222">
        </span>
        <span class="anchor" id="line-223">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-10">
        </span>
        sudo mount -t proc proc ${WORK}/rootfs/proc
       </pre>
       <span class="anchor" id="line-224">
       </span>
       <span class="anchor" id="line-225">
       </span>
       <p class="line867">
        <span class="anchor" id="line-226">
        </span>
        <span class="anchor" id="line-227">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-11">
        </span>
        sudo mount -t sysfs sysfs ${WORK}/rootfs/sys
       </pre>
       <span class="anchor" id="line-228">
       </span>
       <span class="anchor" id="line-229">
       </span>
       <p class="line867">
        <span class="anchor" id="line-230">
        </span>
        <span class="anchor" id="line-231">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-12">
        </span>
        sudo chroot ${WORK}/rootfs /bin/bash
       </pre>
       <span class="anchor" id="line-232">
       </span>
       <span class="anchor" id="line-233">
       </span>
       <span class="anchor" id="line-234">
       </span>
       <p class="line874">
        N.B: All commands done within a chroot will be marked by (chroot).
        <span class="anchor" id="line-235">
        </span>
        <span class="anchor" id="line-236">
        </span>
       </p>
       <ul>
        <li style="list-style-type:none">
         Now you are within chroot environment, type the following command:
         <span class="anchor" id="line-237">
         </span>
        </li>
       </ul>
       <p class="line874">
        (chroot)
        <span class="anchor" id="line-238">
        </span>
        <span class="anchor" id="line-239">
        </span>
        <span class="anchor" id="line-240">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-13">
        </span>
        LANG=
       </pre>
       <span class="anchor" id="line-241">
       </span>
       <span class="anchor" id="line-242">
       </span>
       <ol type="2">
        <li>
         Install Packages Essential for live CD:
         <span class="anchor" id="line-243">
         </span>
        </li>
       </ol>
       <p class="line874">
        (chroot)
        <span class="anchor" id="line-244">
        </span>
        <span class="anchor" id="line-245">
        </span>
        <span class="anchor" id="line-246">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-14">
        </span>
        apt-get update
       </pre>
       <span class="anchor" id="line-247">
       </span>
       <p class="line874">
        (chroot)
        <span class="anchor" id="line-248">
        </span>
        <span class="anchor" id="line-249">
        </span>
        <span class="anchor" id="line-250">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-15">
        </span>
        apt-get install casper lupin-casper
       </pre>
       <span class="anchor" id="line-251">
       </span>
       <span class="anchor" id="line-252">
       </span>
       <p class="line874">
        casper contains the live scripts.
        <span class="anchor" id="line-253">
        </span>
        <span class="anchor" id="line-254">
        </span>
       </p>
       <p class="line874">
        3. (Optional) If you want your live cd to have an installer, install the Ubuntu installer:
        <span class="anchor" id="line-255">
        </span>
        (chroot)
        <span class="anchor" id="line-256">
        </span>
        <span class="anchor" id="line-257">
        </span>
        <span class="anchor" id="line-258">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-16">
        </span>
        apt-get install ubiquity ubiquity-frontend-gtk
       </pre>
       <span class="anchor" id="line-259">
       </span>
       <span class="anchor" id="line-260">
       </span>
       <p class="line874">
        Note: People using kde replace the previous command with:
        <span class="anchor" id="line-261">
        </span>
        (chroot)
        <span class="anchor" id="line-262">
        </span>
        <span class="anchor" id="line-263">
        </span>
        <span class="anchor" id="line-264">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-17">
        </span>
        apt-get install ubiquity ubiquity-frontend-kde
       </pre>
       <span class="anchor" id="line-265">
       </span>
       <p class="line862">
        Credit for this note goe's to
        <a class="http" href="http://ubuntuforums.org/member.php?u=386921">
         Fragadelic
        </a>
        author of
        <a class="http" href="http://www.remastersys.klikit-linux.com/">
         remastersys
        </a>
        .
        <span class="anchor" id="line-266">
        </span>
        <span class="anchor" id="line-267">
        </span>
       </p>
       <p class="line874">
        (Optional Step)Install any packages you want to be in the CD. Some of the following packages are useful in emergency situations:
        <span class="anchor" id="line-268">
        </span>
        <span class="anchor" id="line-269">
        </span>
       </p>
       <p class="line867">
        <span class="anchor" id="line-270">
        </span>
        <span class="anchor" id="line-271">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-18">
        </span>
        sudo apt-get install gparted ms-sys testdisk wipe partimage xfsprogs reiserfsprogs jfsutils ntfs-3g ntfsprogs dosfstools mtools
       </pre>
       <span class="anchor" id="line-272">
       </span>
       <span class="anchor" id="line-273">
       </span>
       <p class="line874">
        gparted: patitioning tool. It is automatically installed as a dependecy of ubiquity.
        <span class="anchor" id="line-274">
        </span>
       </p>
       <ul>
        <li style="list-style-type:none">
         testdisk: Partition scanner and disk recovery tool.
         <span class="anchor" id="line-275">
         </span>
         wipe: Secure file deletion.
         <span class="anchor" id="line-276">
         </span>
         partimage: backup partitions into a compressed image file (like norton ghost).
         <span class="anchor" id="line-277">
         </span>
         xfsprogs reiserfsprogs jfsutils: Tools for handling different filesystems.
         <span class="anchor" id="line-278">
         </span>
         mtools: Tools for manipulating MSDOS files
         <span class="anchor" id="line-279">
         </span>
         <span class="anchor" id="line-280">
         </span>
        </li>
        <li class="gap">
         Update the initramfs:
         <span class="anchor" id="line-281">
         </span>
         <span class="anchor" id="line-282">
         </span>
         First update modules.dep:
         <span class="anchor" id="line-283">
         </span>
        </li>
       </ul>
       <p class="line874">
        (chroot)
        <span class="anchor" id="line-284">
        </span>
        <span class="anchor" id="line-285">
        </span>
        <span class="anchor" id="line-286">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-19">
        </span>
        depmod -a $(uname -r)
       </pre>
       <span class="anchor" id="line-287">
       </span>
       <p class="line874">
        (chroot)
        <span class="anchor" id="line-288">
        </span>
        <span class="anchor" id="line-289">
        </span>
        <span class="anchor" id="line-290">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-20">
        </span>
        update-initramfs -u -k $(uname -r)
       </pre>
       <span class="anchor" id="line-291">
       </span>
       <span class="anchor" id="line-292">
       </span>
       <p class="line874">
        As already metioned above, the initramfs is reponsible for much of the preparation required at the boot time of the CD/DVD. The updated initramfs now contain the live scirpts installed with casper.
        <span class="anchor" id="line-293">
        </span>
        <span class="anchor" id="line-294">
        </span>
       </p>
       <ol type="5">
        <li>
         Remove non system users
         <span class="anchor" id="line-295">
         </span>
        </li>
       </ol>
       <p class="line874">
        (chroot)
        <span class="anchor" id="line-296">
        </span>
        <span class="anchor" id="line-297">
        </span>
        <span class="anchor" id="line-298">
        </span>
        <span class="anchor" id="line-299">
        </span>
        <span class="anchor" id="line-300">
        </span>
        <span class="anchor" id="line-301">
        </span>
        <span class="anchor" id="line-302">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-21">
        </span>
        for i in `cat /etc/passwd | awk -F":" '{print $1}'`
        <span class="anchor" id="line-2-4">
        </span>
        do
        <span class="anchor" id="line-3-4">
        </span>
        uid=`cat /etc/passwd | grep "^${i}:" | awk -F":" '{print $3}'`
        <span class="anchor" id="line-4-4">
        </span>
        [ "$uid" -gt "998" -a  "$uid" -ne "65534"  ] &amp;&amp; userdel --force ${i} 2&gt; /dev/null
        <span class="anchor" id="line-5-2">
        </span>
        done
       </pre>
       <span class="anchor" id="line-303">
       </span>
       <span class="anchor" id="line-304">
       </span>
       <p class="line874">
        Non-system users are users created by you that have user id more than 999.
        <span class="anchor" id="line-305">
        </span>
        <span class="anchor" id="line-306">
        </span>
       </p>
       <ul>
        <li style="list-style-type:none">
         N.B: In case a user with uid 999 is present we remove as well because that uid is preserved for the live cd user.
         <span class="anchor" id="line-307">
         </span>
         <span class="anchor" id="line-308">
         </span>
        </li>
        <li class="gap">
         Clean the system
         <span class="anchor" id="line-309">
         </span>
         <span class="anchor" id="line-310">
         </span>
         First, clean apt cache
         <span class="anchor" id="line-311">
         </span>
        </li>
       </ul>
       <p class="line874">
        (chroot)
        <span class="anchor" id="line-312">
        </span>
        <span class="anchor" id="line-313">
        </span>
        <span class="anchor" id="line-314">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-22">
        </span>
        apt-get clean
       </pre>
       <span class="anchor" id="line-315">
       </span>
       <span class="anchor" id="line-316">
       </span>
       <ul>
        <li style="list-style-type:none">
         Clean all the extra log files
         <span class="anchor" id="line-317">
         </span>
        </li>
       </ul>
       <p class="line874">
        (chroot)
        <span class="anchor" id="line-318">
        </span>
        <span class="anchor" id="line-319">
        </span>
        <span class="anchor" id="line-320">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-23">
        </span>
        find /var/log -regex '.*?[0-9].*?' -exec rm -v {} \;
       </pre>
       <span class="anchor" id="line-321">
       </span>
       <span class="anchor" id="line-322">
       </span>
       <ul>
        <li style="list-style-type:none">
         The remaining log files are going to be zeroed lest the system complain if they are deleted.
         <span class="anchor" id="line-323">
         </span>
        </li>
       </ul>
       <p class="line874">
        (chroot)
        <span class="anchor" id="line-324">
        </span>
        <span class="anchor" id="line-325">
        </span>
        <span class="anchor" id="line-326">
        </span>
        <span class="anchor" id="line-327">
        </span>
        <span class="anchor" id="line-328">
        </span>
        <span class="anchor" id="line-329">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-24">
        </span>
        find /var/log -type f | while read file
        <span class="anchor" id="line-2-5">
        </span>
        do
        <span class="anchor" id="line-3-5">
        </span>
        cat /dev/null | tee $file
        <span class="anchor" id="line-4-5">
        </span>
        done
       </pre>
       <span class="anchor" id="line-330">
       </span>
       <p class="line874">
        (chroot)
        <span class="anchor" id="line-331">
        </span>
        <span class="anchor" id="line-332">
        </span>
        <span class="anchor" id="line-333">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-25">
        </span>
        rm /etc/resolv.conf /etc/hostname
       </pre>
       <span class="anchor" id="line-334">
       </span>
       <span class="anchor" id="line-335">
       </span>
       <ol type="7">
        <li>
         Exit chroot
         <span class="anchor" id="line-336">
         </span>
        </li>
       </ol>
       <p class="line874">
        (chroot)
        <span class="anchor" id="line-337">
        </span>
        <span class="anchor" id="line-338">
        </span>
        <span class="anchor" id="line-339">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-26">
        </span>
        exit
       </pre>
       <span class="anchor" id="line-340">
       </span>
       <span class="anchor" id="line-341">
       </span>
       <p class="line867">
       </p>
       <h1 id="Prepare_The_CD_directory_tree">
        Prepare The CD directory tree
       </h1>
       <span class="anchor" id="line-342">
       </span>
       <span class="anchor" id="line-343">
       </span>
       <ol type="1">
        <li>
         Copy the kernel, the updated initrd and memtest prepared in the chroot:
         <span class="anchor" id="line-344">
         </span>
         <span class="anchor" id="line-345">
         </span>
        </li>
       </ol>
       <p class="line867">
        <span class="anchor" id="line-346">
        </span>
        <span class="anchor" id="line-347">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-27">
        </span>
        export kversion=`cd ${WORK}/rootfs/boot &amp;&amp; ls -1 vmlinuz-* | tail -1 | sed 's@vmlinuz-@@'`
       </pre>
       <span class="anchor" id="line-348">
       </span>
       <span class="anchor" id="line-349">
       </span>
       <p class="line867">
        <span class="anchor" id="line-350">
        </span>
        <span class="anchor" id="line-351">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-28">
        </span>
        sudo cp -vp ${WORK}/rootfs/boot/vmlinuz-${kversion} ${CD}/${FS_DIR}/vmlinuz
       </pre>
       <span class="anchor" id="line-352">
       </span>
       <span class="anchor" id="line-353">
       </span>
       <p class="line867">
        <span class="anchor" id="line-354">
        </span>
        <span class="anchor" id="line-355">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-29">
        </span>
        sudo cp -vp ${WORK}/rootfs/boot/initrd.img-${kversion} ${CD}/${FS_DIR}/initrd.img
       </pre>
       <span class="anchor" id="line-356">
       </span>
       <span class="anchor" id="line-357">
       </span>
       <p class="line867">
        <span class="anchor" id="line-358">
        </span>
        <span class="anchor" id="line-359">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-30">
        </span>
        sudo cp -vp ${WORK}/rootfs/boot/memtest86+.bin ${CD}/boot
       </pre>
       <span class="anchor" id="line-360">
       </span>
       <span class="anchor" id="line-361">
       </span>
       <span class="anchor" id="line-362">
       </span>
       <span class="anchor" id="line-363">
       </span>
       <p class="line874">
        2. (optinal)Generate manifest:
        <span class="anchor" id="line-364">
        </span>
        <span class="anchor" id="line-365">
        </span>
       </p>
       <ul>
        <li style="list-style-type:none">
         <p class="line862">
          Note: This step is only needed if you installed the Ubuntu installer ubiquity. This step generates two files (filesystem.manifest &amp; filesystem.manifest-desktop).
          <span class="anchor" id="line-366">
          </span>
         </p>
        </li>
       </ul>
       <p class="line874">
        (optinal)
        <span class="anchor" id="line-367">
        </span>
        <span class="anchor" id="line-368">
        </span>
        <span class="anchor" id="line-369">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-31">
        </span>
        sudo chroot ${WORK}/rootfs dpkg-query -W --showformat='${Package} ${Version}\n' | sudo tee ${CD}/${FS_DIR}/filesystem.manifest
       </pre>
       <span class="anchor" id="line-370">
       </span>
       <p class="line874">
        (optinal)
        <span class="anchor" id="line-371">
        </span>
        <span class="anchor" id="line-372">
        </span>
        <span class="anchor" id="line-373">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-32">
        </span>
        sudo cp -v ${CD}/${FS_DIR}/filesystem.manifest{,-desktop}
       </pre>
       <span class="anchor" id="line-374">
       </span>
       <p class="line874">
        (optinal)
        <span class="anchor" id="line-375">
        </span>
        <span class="anchor" id="line-376">
        </span>
        <span class="anchor" id="line-377">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-33">
        </span>
        REMOVE='ubiquity casper user-setup os-prober libdebian-installer4'
       </pre>
       <span class="anchor" id="line-378">
       </span>
       <p class="line874">
        (optinal)
        <span class="anchor" id="line-379">
        </span>
        <span class="anchor" id="line-380">
        </span>
        <span class="anchor" id="line-381">
        </span>
        <span class="anchor" id="line-382">
        </span>
        <span class="anchor" id="line-383">
        </span>
        <span class="anchor" id="line-384">
        </span>
        <span class="anchor" id="line-385">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-34">
        </span>
        for i in $REMOVE
        <span class="anchor" id="line-2-6">
        </span>
        do
        <span class="anchor" id="line-3-6">
        </span>
        sudo sed -i "/${i}/d" ${CD}/${FS_DIR}/filesystem.manifest-desktop
        <span class="anchor" id="line-4-6">
        </span>
        done
       </pre>
       <span class="anchor" id="line-386">
       </span>
       <p class="line874">
        (optinal)
        <span class="anchor" id="line-387">
        </span>
        These two files are used by the ubiquity installer when installing to harddisk. These two files are just lists of packages. Ubiquity compares these two files and removes packages unique to filesystem.manifest. This way when installing to harddisk, packages like casper which is only useful in a live CD/DVD are removed. These packages that will be removed at install are defined in the variable $REMOVE
        <span class="anchor" id="line-388">
        </span>
        <span class="anchor" id="line-389">
        </span>
        <span class="anchor" id="line-390">
        </span>
       </p>
       <ol type="3">
        <li>
         Unmount bind mounted dirs:
         <span class="anchor" id="line-391">
         </span>
         <span class="anchor" id="line-392">
         </span>
         <span class="anchor" id="line-393">
         </span>
         <span class="anchor" id="line-394">
         </span>
        </li>
       </ol>
       <p class="line867">
        <span class="anchor" id="line-395">
        </span>
        <span class="anchor" id="line-396">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-35">
        </span>
        sudo umount ${WORK}/rootfs/proc
       </pre>
       <span class="anchor" id="line-397">
       </span>
       <span class="anchor" id="line-398">
       </span>
       <p class="line867">
        <span class="anchor" id="line-399">
        </span>
        <span class="anchor" id="line-400">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-36">
        </span>
        sudo umount ${WORK}/rootfs/sys
       </pre>
       <span class="anchor" id="line-401">
       </span>
       <span class="anchor" id="line-402">
       </span>
       <p class="line867">
        <span class="anchor" id="line-403">
        </span>
        <span class="anchor" id="line-404">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-37">
        </span>
        sudo umount ${WORK}/rootfs/dev
       </pre>
       <span class="anchor" id="line-405">
       </span>
       <span class="anchor" id="line-406">
       </span>
       <ol type="4">
        <li>
         Convert the directory tree into a squashfs:
         <span class="anchor" id="line-407">
         </span>
         <span class="anchor" id="line-408">
         </span>
        </li>
       </ol>
       <p class="line867">
        <span class="anchor" id="line-409">
        </span>
        <span class="anchor" id="line-410">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-38">
        </span>
        sudo mksquashfs ${WORK}/rootfs ${CD}/${FS_DIR}/filesystem.${FORMAT} -noappend
       </pre>
       <span class="anchor" id="line-411">
       </span>
       <span class="anchor" id="line-412">
       </span>
       <p class="line874">
        Note: Make sure the resulting file size can fit into your live media.
        <span class="anchor" id="line-413">
        </span>
        <span class="anchor" id="line-414">
        </span>
        <span class="anchor" id="line-415">
        </span>
       </p>
       <ol type="5">
        <li>
         Make filesystem.size
         <span class="anchor" id="line-416">
         </span>
         <span class="anchor" id="line-417">
         </span>
        </li>
       </ol>
       <p class="line867">
        <span class="anchor" id="line-418">
        </span>
        <span class="anchor" id="line-419">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-39">
        </span>
        echo -n $(sudo du -s --block-size=1 ${WORK}/rootfs | tail -1 | awk '{print $1}') | sudo tee ${CD}/${FS_DIR}/filesystem.size
       </pre>
       <span class="anchor" id="line-420">
       </span>
       <span class="anchor" id="line-421">
       </span>
       <ol type="6">
        <li>
         Calculate MD5
         <span class="anchor" id="line-422">
         </span>
         <span class="anchor" id="line-423">
         </span>
        </li>
       </ol>
       <p class="line867">
        <span class="anchor" id="line-424">
        </span>
        <span class="anchor" id="line-425">
        </span>
        <span class="anchor" id="line-426">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-40">
        </span>
        find ${CD} -type f -print0 | xargs -0 md5sum | sed "s@${CD}@.@" | grep -v md5sum.txt | sudo tee -a ${CD}/md5sum.txt
       </pre>
       <span class="anchor" id="line-427">
       </span>
       <span class="anchor" id="line-428">
       </span>
       <ol type="7">
        <li>
         Make Grub the bootloader of the CD
         <span class="anchor" id="line-429">
         </span>
         <span class="anchor" id="line-430">
         </span>
         <span class="anchor" id="line-431">
         </span>
         Make the grub.cfg
         <span class="anchor" id="line-432">
         </span>
         <span class="anchor" id="line-433">
         </span>
        </li>
       </ol>
       <p class="line867">
        <span class="anchor" id="line-434">
        </span>
        <span class="anchor" id="line-435">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-41">
        </span>
        sudo gedit ${CD}/boot/grub/grub.cfg
       </pre>
       <span class="anchor" id="line-436">
       </span>
       <span class="anchor" id="line-437">
       </span>
       <span class="anchor" id="line-438">
       </span>
       <ul>
        <li style="list-style-type:none">
         Copy the following text into it and save it.
         <span class="anchor" id="line-439">
         </span>
         <span class="anchor" id="line-440">
         </span>
        </li>
       </ul>
       <p class="line867">
        <span class="anchor" id="line-441">
        </span>
        <span class="anchor" id="line-442">
        </span>
        <span class="anchor" id="line-443">
        </span>
        <span class="anchor" id="line-444">
        </span>
        <span class="anchor" id="line-445">
        </span>
        <span class="anchor" id="line-446">
        </span>
        <span class="anchor" id="line-447">
        </span>
        <span class="anchor" id="line-448">
        </span>
        <span class="anchor" id="line-449">
        </span>
        <span class="anchor" id="line-450">
        </span>
        <span class="anchor" id="line-451">
        </span>
        <span class="anchor" id="line-452">
        </span>
        <span class="anchor" id="line-453">
        </span>
        <span class="anchor" id="line-454">
        </span>
        <span class="anchor" id="line-455">
        </span>
        <span class="anchor" id="line-456">
        </span>
        <span class="anchor" id="line-457">
        </span>
        <span class="anchor" id="line-458">
        </span>
        <span class="anchor" id="line-459">
        </span>
        <span class="anchor" id="line-460">
        </span>
        <span class="anchor" id="line-461">
        </span>
        <span class="anchor" id="line-462">
        </span>
        <span class="anchor" id="line-463">
        </span>
        <span class="anchor" id="line-464">
        </span>
        <span class="anchor" id="line-465">
        </span>
        <span class="anchor" id="line-466">
        </span>
        <span class="anchor" id="line-467">
        </span>
        <span class="anchor" id="line-468">
        </span>
        <span class="anchor" id="line-469">
        </span>
        <span class="anchor" id="line-470">
        </span>
        <span class="anchor" id="line-471">
        </span>
        <span class="anchor" id="line-472">
        </span>
        <span class="anchor" id="line-473">
        </span>
        <span class="anchor" id="line-474">
        </span>
        <span class="anchor" id="line-475">
        </span>
        <span class="anchor" id="line-476">
        </span>
        <span class="anchor" id="line-477">
        </span>
        <span class="anchor" id="line-478">
        </span>
        <span class="anchor" id="line-479">
        </span>
        <span class="anchor" id="line-480">
        </span>
        <span class="anchor" id="line-481">
        </span>
        <span class="anchor" id="line-482">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-42">
        </span>
        set default="0"
        <span class="anchor" id="line-2-7">
        </span>
        set timeout=10
        <span class="anchor" id="line-3-7">
        </span>
        <span class="anchor" id="line-4-7">
        </span>
        menuentry "Ubuntu GUI" {
        <span class="anchor" id="line-5-3">
        </span>
        linux /casper/vmlinuz boot=casper quiet splash
        <span class="anchor" id="line-6-2">
        </span>
        initrd /casper/initrd.img
        <span class="anchor" id="line-7-2">
        </span>
        }
        <span class="anchor" id="line-8-2">
        </span>
        <span class="anchor" id="line-9-1">
        </span>
        menuentry "Ubuntu in safe mode" {
        <span class="anchor" id="line-10-1">
        </span>
        linux /casper/vmlinuz boot=casper xforcevesa quiet splash
        <span class="anchor" id="line-11-1">
        </span>
        initrd /casper/initrd.img
        <span class="anchor" id="line-12-1">
        </span>
        }
        <span class="anchor" id="line-13-1">
        </span>
        <span class="anchor" id="line-14-1">
        </span>
        menuentry "Ubuntu CLI" {
        <span class="anchor" id="line-15-1">
        </span>
        linux /casper/vmlinuz boot=casper textonly quiet splash
        <span class="anchor" id="line-16-1">
        </span>
        initrd /casper/initrd.img
        <span class="anchor" id="line-17">
        </span>
        }
        <span class="anchor" id="line-18">
        </span>
        <span class="anchor" id="line-19">
        </span>
        menuentry "Ubuntu GUI persistent mode" {
        <span class="anchor" id="line-20">
        </span>
        linux /casper/vmlinuz boot=casper persistent quiet splash
        <span class="anchor" id="line-21">
        </span>
        initrd /casper/initrd.img
        <span class="anchor" id="line-22">
        </span>
        }
        <span class="anchor" id="line-23">
        </span>
        <span class="anchor" id="line-24">
        </span>
        menuentry "Ubuntu GUI from RAM" {
        <span class="anchor" id="line-25">
        </span>
        linux /casper/vmlinuz boot=casper toram quiet splash
        <span class="anchor" id="line-26">
        </span>
        initrd /casper/initrd.img
        <span class="anchor" id="line-27">
        </span>
        }
        <span class="anchor" id="line-28">
        </span>
        <span class="anchor" id="line-29">
        </span>
        menuentry "Check Disk for Defects" {
        <span class="anchor" id="line-30">
        </span>
        linux /casper/vmlinuz boot=casper integrity-check quiet splash
        <span class="anchor" id="line-31">
        </span>
        initrd /casper/initrd.img
        <span class="anchor" id="line-32">
        </span>
        }
        <span class="anchor" id="line-33">
        </span>
        <span class="anchor" id="line-34">
        </span>
        menuentry "Memory Test" {
        <span class="anchor" id="line-35">
        </span>
        linux16 /boot/memtest86+.bin
        <span class="anchor" id="line-36">
        </span>
        }
        <span class="anchor" id="line-37">
        </span>
        <span class="anchor" id="line-38">
        </span>
        menuentry "Boot from the first hard disk" {
        <span class="anchor" id="line-39">
        </span>
        set root=(hd0)
        <span class="anchor" id="line-40">
        </span>
        chainloader +1
        <span class="anchor" id="line-41">
        </span>
        }
       </pre>
       <span class="anchor" id="line-483">
       </span>
       <span class="anchor" id="line-484">
       </span>
       <p class="line867">
       </p>
       <h1 id="Build_the_CD.2FDVD">
        Build the CD/DVD
       </h1>
       <span class="anchor" id="line-485">
       </span>
       <span class="anchor" id="line-486">
       </span>
       <ol type="1">
        <li>
         Make the ISO file
         <span class="anchor" id="line-487">
         </span>
         <span class="anchor" id="line-488">
         </span>
        </li>
       </ol>
       <p class="line867">
        <span class="anchor" id="line-489">
        </span>
        <span class="anchor" id="line-490">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-43">
        </span>
        sudo grub-mkrescue -o ~/live-cd.iso ${CD}
       </pre>
       <span class="anchor" id="line-491">
       </span>
       <span class="anchor" id="line-492">
       </span>
       <ol type="2">
        <li>
         Test the CD
         <span class="anchor" id="line-493">
         </span>
         <span class="anchor" id="line-494">
         </span>
         Test using qemu emulator
         <span class="anchor" id="line-495">
         </span>
         <span class="anchor" id="line-496">
         </span>
         <span class="anchor" id="line-497">
         </span>
        </li>
       </ol>
       <p class="line867">
        <span class="anchor" id="line-498">
        </span>
        <span class="anchor" id="line-499">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-44">
        </span>
        qemu -cdrom ~/live-cd.iso -boot d
       </pre>
       <span class="anchor" id="line-500">
       </span>
       <span class="anchor" id="line-501">
       </span>
       <p class="line874">
        Or use any other virtualization program you like.
        <span class="anchor" id="line-502">
        </span>
        <span class="anchor" id="line-503">
        </span>
        <span class="anchor" id="line-504">
        </span>
       </p>
       <p class="line867">
        <strong>
         Update: As noted by
         <a class="http" href="http://ubuntuforums.org/member.php?u=844">
          az
         </a>
         while testing the iso with qemu sometimes it drops you to an initramfs shell because of a problem with qemu. This behaviour has been confirmed by other users. In this case it is advisable to retest the iso with another virtualization software like virtualbox or to copy the iso to flash disk and test directly on your pc (See Appendix 2.).
        </strong>
        <span class="anchor" id="line-505">
        </span>
        <span class="anchor" id="line-506">
        </span>
        <span class="anchor" id="line-507">
        </span>
       </p>
       <p class="line874">
        3. (Optional) Clean our workspace
        <span class="anchor" id="line-508">
        </span>
        <span class="anchor" id="line-509">
        </span>
        <span class="anchor" id="line-510">
        </span>
        <span class="anchor" id="line-511">
        </span>
       </p>
       <p class="line867">
        <span class="anchor" id="line-512">
        </span>
        <span class="anchor" id="line-513">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-45">
        </span>
        [ -d "$WORK" ] &amp;&amp; rm -r $WORK $CD
       </pre>
       <span class="anchor" id="line-514">
       </span>
       <span class="anchor" id="line-515">
       </span>
       <p class="line867">
       </p>
       <h1 id="Final_Notes">
        Final Notes
       </h1>
       <span class="anchor" id="line-516">
       </span>
       <span class="anchor" id="line-517">
       </span>
       <ul>
        <li>
         If you are using a custom kernel make sure it has support for the following:
         <span class="anchor" id="line-518">
         </span>
         <span class="anchor" id="line-519">
         </span>
         <span class="anchor" id="line-520">
         </span>
         <ul>
          <li>
           Support of loopback device.
           <span class="anchor" id="line-521">
           </span>
          </li>
          <li>
           Support for squashfs.
           <span class="anchor" id="line-522">
           </span>
          </li>
          <li>
           Support for aufs2.
           <span class="anchor" id="line-523">
           </span>
          </li>
          <li>
           Support for initramfs.
           <span class="anchor" id="line-524">
           </span>
           <span class="anchor" id="line-525">
           </span>
           <span class="anchor" id="line-526">
           </span>
           <span class="anchor" id="line-527">
           </span>
           <span class="anchor" id="line-528">
           </span>
           <span class="anchor" id="line-529">
           </span>
          </li>
         </ul>
        </li>
        <li class="gap">
         There are some extra options I put in the grub menu:
         <span class="anchor" id="line-530">
         </span>
         <span class="anchor" id="line-531">
         </span>
         <span class="anchor" id="line-532">
         </span>
         <span class="anchor" id="line-533">
         </span>
         <ul>
          <li>
           Start linux form RAM. This option is only possible if your ram is larger than data on the live media. This option can be useful if you are building a minimal command line rescue disc as it would enhance performance to start it from RAM.
           <span class="anchor" id="line-534">
           </span>
           <span class="anchor" id="line-535">
           </span>
           <span class="anchor" id="line-536">
           </span>
          </li>
          <li class="gap">
           <p class="line862">
            Start in presistent mode. To learn about it more look
            <a class="https" href="https://help.ubuntu.com/community/LiveCDPersistence">
             here
            </a>
            .
            <span class="anchor" id="line-537">
            </span>
            <span class="anchor" id="line-538">
            </span>
            <span class="anchor" id="line-539">
            </span>
           </p>
          </li>
          <li class="gap">
           Start Linux in Text Mode. This will not start X. The user will be autologged into a virtual terminal (the kind of terminal you get when you press Alt+Ctrl+F1).
           <span class="anchor" id="line-540">
           </span>
           <span class="anchor" id="line-541">
           </span>
           <span class="anchor" id="line-542">
           </span>
          </li>
         </ul>
        </li>
       </ul>
       <p class="line867">
       </p>
       <h1 id="Building_the_live_media_form_scratch_using_debootstrap">
        Building the live media form scratch using debootstrap
       </h1>
       <span class="anchor" id="line-543">
       </span>
       <span class="anchor" id="line-544">
       </span>
       <ul>
        <li style="list-style-type:none">
         <p class="line862">
          Instead of using your current installation to be the basis of you live CD, you can build a custom clean system from scratch using
          <a class="http" href="http://ubuntuforums.org/showpost.php?p=4887531&amp;postcount=65">
           debootstrap
          </a>
          , and then use that as the basis of your CD. The modifications you have to make are:
          <span class="anchor" id="line-545">
          </span>
          <span class="anchor" id="line-546">
          </span>
          <span class="anchor" id="line-547">
          </span>
          <span class="anchor" id="line-548">
          </span>
         </p>
         <ul>
          <li>
           <p class="line862">
            Skip steps B &amp; C alltogether. Instead, do the instructions listed
            <a class="http" href="http://ubuntuforums.org/showpost.php?p=4887531&amp;postcount=65">
             here
            </a>
            to build your custom system from scratch using debootstarp
            <span class="anchor" id="line-549">
            </span>
            <span class="anchor" id="line-550">
            </span>
           </p>
          </li>
          <li class="gap">
           After finishing the instructions of the guide mentioned above, you resume the steps in this guide, going straight to step D.
           <span class="anchor" id="line-551">
           </span>
           <span class="anchor" id="line-552">
           </span>
          </li>
         </ul>
        </li>
       </ul>
       <p class="line867">
       </p>
       <h1 id="Appendix_2._How_to_Make_bootable_USB_flash">
        Appendix 2. How to Make bootable USB flash
       </h1>
       <span class="anchor" id="line-553">
       </span>
       <span class="anchor" id="line-554">
       </span>
       <span class="anchor" id="line-555">
       </span>
       <ul>
        <li style="list-style-type:none">
         Grub2 has many advantages. One of these is the ability to boot an ISO directly from HDD of a flash. This means that instead of burning the ISO to a CD/DVD you can just copy it to a USB flash disk and boot it from there.
         <span class="anchor" id="line-556">
         </span>
         <span class="anchor" id="line-557">
         </span>
         Another big advantage of Grub2 is that it supports UUIDs and LABELs which are better than device names because they are subject to change especially with flash disks.
         <span class="anchor" id="line-558">
         </span>
         <span class="anchor" id="line-559">
         </span>
         We need to know the UUID or the LABEL for the partition on which the ISO resides. We also need the device name of the usb flash (it will be used once to install grub to the flash drive). We can know that by issuing the following command which lists all the partition details:
         <span class="anchor" id="line-560">
         </span>
         <span class="anchor" id="line-561">
         </span>
         <span class="anchor" id="line-562">
         </span>
         <span class="anchor" id="line-563">
         </span>
        </li>
       </ul>
       <p class="line867">
        <span class="anchor" id="line-564">
        </span>
        <span class="anchor" id="line-565">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-46">
        </span>
        sudo blkid
       </pre>
       <span class="anchor" id="line-566">
       </span>
       <span class="anchor" id="line-567">
       </span>
       <span class="anchor" id="line-568">
       </span>
       <ul>
        <li style="list-style-type:none">
         Take note of the flash UUID (or LABEL) and the flash device name ( e.g /dev/sdc not /dev/sdc1)
         <span class="anchor" id="line-569">
         </span>
         <span class="anchor" id="line-570">
         </span>
         Now mount your flash drive:
         <span class="anchor" id="line-571">
         </span>
         <span class="anchor" id="line-572">
         </span>
         <span class="anchor" id="line-573">
         </span>
         <span class="anchor" id="line-574">
         </span>
        </li>
       </ul>
       <p class="line867">
        <span class="anchor" id="line-575">
        </span>
        <span class="anchor" id="line-576">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-47">
        </span>
        sudo mount -t vfat /dev/by-uuid/&lt;insert uuid here&gt; /mnt
       </pre>
       <span class="anchor" id="line-577">
       </span>
       <span class="anchor" id="line-578">
       </span>
       <p class="line874">
        Install grub to the flash disk:
        <span class="anchor" id="line-579">
        </span>
        <span class="anchor" id="line-580">
        </span>
        <span class="anchor" id="line-581">
        </span>
        <span class="anchor" id="line-582">
        </span>
       </p>
       <p class="line867">
        <span class="anchor" id="line-583">
        </span>
        <span class="anchor" id="line-584">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-48">
        </span>
        sudo grub-install --no-floppy --force --root-directory=/mnt /dev/sdc
       </pre>
       <span class="anchor" id="line-585">
       </span>
       <span class="anchor" id="line-586">
       </span>
       <p class="line874">
        replace the /dev/sdc with the device name of your flash. Note that we are using the device name of the flash itself not the partition in the flash (e.g. /dev/sdc not /dev/sdc1)
        <span class="anchor" id="line-587">
        </span>
        <span class="anchor" id="line-588">
        </span>
        <span class="anchor" id="line-589">
        </span>
       </p>
       <ul>
        <li style="list-style-type:none">
         Copy the ISO to the flash drive:
         <span class="anchor" id="line-590">
         </span>
         <span class="anchor" id="line-591">
         </span>
        </li>
       </ul>
       <p class="line867">
        <span class="anchor" id="line-592">
        </span>
        <span class="anchor" id="line-593">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-49">
        </span>
        cp -v ~/live-cd.iso /mnt
       </pre>
       <span class="anchor" id="line-594">
       </span>
       <span class="anchor" id="line-595">
       </span>
       <span class="anchor" id="line-596">
       </span>
       <ul>
        <li style="list-style-type:none">
         Make the grub menu of the flash disk
         <span class="anchor" id="line-597">
         </span>
         <span class="anchor" id="line-598">
         </span>
        </li>
       </ul>
       <p class="line867">
        <span class="anchor" id="line-599">
        </span>
        <span class="anchor" id="line-600">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-50">
        </span>
        sudo gedit /mnt/boot/grub/grub.cfg
       </pre>
       <span class="anchor" id="line-601">
       </span>
       <span class="anchor" id="line-602">
       </span>
       <p class="line874">
        and add the following entry
        <span class="anchor" id="line-603">
        </span>
        <span class="anchor" id="line-604">
        </span>
       </p>
       <p class="line867">
        <span class="anchor" id="line-605">
        </span>
        <span class="anchor" id="line-606">
        </span>
        <span class="anchor" id="line-607">
        </span>
        <span class="anchor" id="line-608">
        </span>
        <span class="anchor" id="line-609">
        </span>
        <span class="anchor" id="line-610">
        </span>
        <span class="anchor" id="line-611">
        </span>
        <span class="anchor" id="line-612">
        </span>
        <span class="anchor" id="line-613">
        </span>
        <span class="anchor" id="line-614">
        </span>
        <span class="anchor" id="line-615">
        </span>
        <span class="anchor" id="line-616">
        </span>
        <span class="anchor" id="line-617">
        </span>
        <span class="anchor" id="line-618">
        </span>
        <span class="anchor" id="line-619">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-51">
        </span>
        set default="0"
        <span class="anchor" id="line-2-8">
        </span>
        set timeout=10
        <span class="anchor" id="line-3-8">
        </span>
        <span class="anchor" id="line-4-8">
        </span>
        insmod ntfs
        <span class="anchor" id="line-5-4">
        </span>
        search --no-floppy --fs-uuid &lt;insert the UUID&gt; --set=usb
        <span class="anchor" id="line-6-3">
        </span>
        set iso_path=/live-cd.iso
        <span class="anchor" id="line-7-3">
        </span>
        loopback loop (${usb})${iso_path}
        <span class="anchor" id="line-8-3">
        </span>
        set root=(loop)
        <span class="anchor" id="line-9-2">
        </span>
        set bootopts="boot=casper iso-scan/filename=${iso_path} noprompt"
        <span class="anchor" id="line-10-2">
        </span>
        <span class="anchor" id="line-11-2">
        </span>
        menuentry "Boot ISO from HDD/USB" {
        <span class="anchor" id="line-12-2">
        </span>
        linux (loop)/casper/vmlinuz $bootopts
        <span class="anchor" id="line-13-2">
        </span>
        initrd (loop)/casper/initrd.img
        <span class="anchor" id="line-14-2">
        </span>
        }
       </pre>
       <span class="anchor" id="line-620">
       </span>
       <span class="anchor" id="line-621">
       </span>
       <ul>
        <li style="list-style-type:none">
         Replace ntfs with the filesystem of your flash disk. e.g ntfs, fat, ......
         <span class="anchor" id="line-622">
         </span>
         <span class="anchor" id="line-623">
         </span>
         Replace insert the UUID with the UUID of your flash disk.
         <span class="anchor" id="line-624">
         </span>
         <span class="anchor" id="line-625">
         </span>
         Note: If you want to use LABEL instead of UUID replace the first line in the entry with
         <span class="anchor" id="line-626">
         </span>
         <span class="anchor" id="line-627">
         </span>
         <span class="anchor" id="line-628">
         </span>
         <span class="anchor" id="line-629">
         </span>
        </li>
       </ul>
       <p class="line867">
        <span class="anchor" id="line-630">
        </span>
        <span class="anchor" id="line-631">
        </span>
       </p>
       <pre>
        <span class="anchor" id="line-1-52">
        </span>
        search --no-floppy -l insert the LABEL --set=usb
       </pre>
       <span class="anchor" id="line-632">
       </span>
       <span class="anchor" id="line-633">
       </span>
       <span class="anchor" id="line-634">
       </span>
       <span class="anchor" id="line-635">
       </span>
       <ul>
        <li style="list-style-type:none">
         When you start you pc you have to select "boot from usb storage device" from your BIOS boot options.
         <span class="anchor" id="line-636">
         </span>
         <span class="anchor" id="line-637">
         </span>
        </li>
       </ul>
       <p class="line862">
        Originally posted
        <a class="http" href="http://ubuntuforums.org/showthread.php?t=688872">
         The Ubuntu Forums (ubuntuforums.org)
        </a>
        <span class="anchor" id="line-638">
        </span>
        <span class="anchor" id="bottom">
        </span>
       </p>
      </div>
      <div id="pagebottom">
      </div>
     </div>
    </div>
    <p class="info" dir="ltr" id="pageinfo" lang="en">
     MakeALiveCD/DVD/BootableFlashFromHarddiskInstall  (last edited 2012-07-24 16:42:47 by
     <span title="wzyboy @ 64.34.204.41[64.34.204.41]">
      <a class="interwiki" href="https://launchpad.net/~wzyboy" title="wzyboy @ 64.34.204.41[64.34.204.41]">
       wzyboy
      </a>
     </span>
     )
    </p>
   </div>
   <div id="footer">
    <p>
     The material on this wiki is available under a free license, see
     <a href="https://help.ubuntu.com/community/
		License">
      Copyright / License
     </a>
     for details
     <br/>
     <b>
      You
     </b>
     can contribute to this wiki, see
     <a href="https://help.ubuntu.com/community/WikiGuide">
      Wiki Guide
     </a>
     for details
    </p>
   </div>
  </div>
 </body>
</html>