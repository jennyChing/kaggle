<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <title>
   28th Records - The Boom Box
  </title>
  <meta content="The Boom Box is a web experiment letting you play sounds and make a visual show just with your keyboard." name="description"/>
  <meta content="28th Records" name="author"/>
  <!-- Twitter Card data -->
  <meta content="summary" name="twitter:card"/>
  <meta content="@28thRecords" name="twitter:site"/>
  <meta content="28th Records - The Boom Box" name="twitter:title"/>
  <meta content="The Boom Box is a web experiment letting you play sounds and make a visual show just with your keyboard." name="twitter:description"/>
  <meta content="@28threcords" name="twitter:creator"/>
  <meta content="http://www.28threcords.com/wp-content/uploads/2014/05/theboobox.png" name="twitter:image"/>
  <!-- Open Graph data -->
  <meta content="28th Records - The Boom Box" property="og:title"/>
  <meta content="website" property="og:type"/>
  <meta content="http://www.28threcords.com/wp-content/uploads/2014/05/theboobox.png" property="og:image"/>
  <meta content="The Boom Box is a web experiment letting you play sounds and make a visual show just with your keyboard." property="og:description"/>
  <meta content="28th Records" property="og:site_name"/>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js">
  </script>
  <script src="libs/buffer-loader.js">
  </script>
  <script src="libs/processing.min.js">
  </script>
  <style>
   html, body {
			  height: 100vh;
			  width: 100vw;
			}

			body {
			 	display: table-cell;
				vertical-align: middle;
				margin: 0;
				font: normal 15px "Helvetica Neue", Helvetica, Arial, sans-serif;
				background: #000;
				-webkit-font-smoothing: antialiased;
				color: #FFF;
				-webkit-font-smoothing: subpixel-antialiased;
				text-rendering: optimizeLegibility;
			}

			a {
			  text-decoration: none;
			  color: #404048;
			}
						
			#canvas1{
				opacity:0;
				-moz-opacity:0;
				-webkit-opacity:0;
				position:fixed;
				top:50%;
				transform:translateY(-50%);
				-moz-transform:translateY(-50%);
				-webkit-transform:translateY(-50%);
				left:0;
				width:100%;
			}
			body.loaded #canvas1{
				
				opacity:1;
				-moz-opacity:1;
				-webkit-opacity:1;
			}
			#loading-screen{
				position: fixed;
				left: 0;
				top: 0;
				height: 100%;
				width: 100%;
				background: #000;
				display: table;
				z-index:999;
			}
			#loading-screen .center{
				text-align: center;
				display: table-cell;
				height: 100%;
				vertical-align: middle;
			}
			#loading-bar-wrapper{
				width:200px;
				margin:1em auto;
			}
			#loading-bar-wrapper #loading-bar{
				border-bottom:3px solid white;
				width:0;
			}
			.title{
				position: fixed;
				top: 0;
				text-transform: uppercase;
				max-width: 200px;
				font-size: 2em;
			}
			.title h1{
				color: #FFF;
				font-weight: normal;
				margin: 0;
			}
			.bottom-title{
				position: fixed;
				bottom: 0;
				left: 0;
				font-size: 12px;
				margin-bottom: 10px;
				margin-left: 5px;
				color: #777;
			}
			.copyright{
				position: fixed;
				bottom: 0;
				right: 0;
				font-size: 12px;
				margin-bottom: 10px;
				margin-right: 5px;
				color: #777;
			}
  </style>
 </head>
 <body>
  <canvas data-processing-sources="libs/theboombox.pde" id="canvas1">
  </canvas>
  <div id="loading-screen">
   <div class="center">
    <img alt="28th Records" class="logo" src="http://www.28threcords.com/wp-content/uploads/2014/09/28th_records_logo_small.png"/>
    <div id="loading-bar-wrapper">
     <div id="loading-bar">
     </div>
    </div>
   </div>
  </div>
  <div class="title">
   <h1>
    The Boom Box
   </h1>
  </div>
  <div class="bottom-title">
   Press any key, A to Z, and turn up speakers.
  </div>
  <div class="copyright">
   
   <a href="http://www.28threcords.com/" title="28th Records, Electronic music label">
    28th Records
   </a>
  </div>
  <div id="loading">
  </div>
  <script>
   // Disable scrolling
            $(window)
            .bind('touchstart touchmove touchend touchcancel', function(e) {
                e.preventDefault();
                return false;
            })
            .bind('keydown', function(event, data) {
                if (event.keyCode &gt;= 65 &amp;&amp; event.keyCode &lt;= 90) {
                    var index=event.keyCode-65;
                    trigger(index);
                    $( ".bottom-bar" ).removeClass('open');
                }
            });
            
            function trigger(index){
                playSound(index);
                playAnimation(index);
            }
            
            
            var web_audio_context;
            var source = null;
			//var audioBuffer = null;
            $(document).ready(function () {
    			if (typeof AudioContext !== "undefined"){
    				web_audio_context = new AudioContext();
    				console.log("Created AudioContext");
    			}
    			else if (typeof webkitAudioContext !== "undefined"){
    				web_audio_context = new webkitAudioContext();
    				console.log("Created webkitAudioContext");
    			}
    			else{
    				console.log("Web Audio API does not appear to be supported");
    				return;
    			}
    			
    			for(var i=0;i&lt;26; i++){
        			loadSoundFile(i);
    			}
    		});
    		function playSound(index) {
				source = web_audio_context.createBufferSource();
				source.buffer = buffers[index]//audioBuffer;
				source.loop = false;
				var gain = web_audio_context.createGain();
                source.connect(gain);
                gain.gain.value = .1;
                gain.connect(web_audio_context.destination);

				source.connect(web_audio_context.destination);
				source.start(0); // Play immediately.
    		}
    		function loadSoundFile(index) {
				var xhr = new XMLHttpRequest();
				var url = 'audio-stream.php?id='+index+'&amp;k='+public_keys[index];
				xhr.open('GET', url, true);
				xhr.responseType = 'arraybuffer';
				xhr.onload = function(e) {
					initSound(index,this.response); // this.response is an ArrayBuffer.
				};
				xhr.send();
			}
			var buffers=[];
			function initSound(index,arrayBuffer) {
			    updateLoading();
				web_audio_context.decodeAudioData(arrayBuffer, function(buffer) {
				buffers[index] = buffer;
				}, function(e) {
					console.log('Error decoding file', e);
				}); 
			}
			
        var public_keys=[];
                    public_keys[0] = 6413;
                    public_keys[1] = 3812;
                    public_keys[2] = 2684;
                    public_keys[3] = 5573;
                    public_keys[4] = 3273;
                    public_keys[5] = 4293;
                    public_keys[6] = 8669;
                    public_keys[7] = 9527;
                    public_keys[8] = 1287;
                    public_keys[9] = 7264;
                    public_keys[10] = 7067;
                    public_keys[11] = 7943;
                    public_keys[12] = 3271;
                    public_keys[13] = 9528;
                    public_keys[14] = 8450;
                    public_keys[15] = 7164;
                    public_keys[16] = 1276;
                    public_keys[17] = 7021;
                    public_keys[18] = 1540;
                    public_keys[19] = 1862;
                    public_keys[20] = 3601;
                    public_keys[21] = 2319;
                    public_keys[22] = 8930;
                    public_keys[23] = 9042;
                    public_keys[24] = 1680;
                    public_keys[25] = 1813;
                
        function playAnimation(index){
            switch(index)
            {
            case 0:
              slide("255,255,255");
              break;
            case 1:
              jail3();
              break;
            case 2:
              plainTriangle("255,255,255");
              break;
            case 3:
              logo();
              break;
            case 4:
              blink("255,255,255");
              break;
            case 5:
              jail();
              break;
            case 6:
              plainRect();
              break;
            case 7:
              rline("255,255,255");
              break;
            case 8:
              jail4("255,255,255");
              break;
            case 9:
              blink("255,255,255");
              break;
            case 10:
              slide("255,255,255");
              break;
            case 11:
              circle("255,255,255");
              break;
            case 12:
              jail4();
              break;
            case 13:
              logo();
              break;
            case 14:
              rline("255,255,255");
              break;
            case 15:
              blob();
              break;
            case 16:
              vline("255,255,255");
              break;
            case 17:
              verticalSlide("255,255,255");
              break;
            case 18:
              blink("255,255,255");
              break;
            case 19:
              hline("255,255,255");
              break;
            case 20:
              jail2();
              break;
            case 21:
              disc("255,255,255");
              break;
            case 22:
              blob();
              break;
            case 23:
              rect();
              break;
            case 24:
              logo();
              break;
            case 25:
              triangle("255,255,255");
              break;
            case 26:
              hline("255,255,255");
              break;
            default:
            }
        }
        
        var loading=0;
		var totalLoading = 26;
		var loadingPercent=0;
        function updateLoading(){
            loading++;
			loadingPercent=loading*100/totalLoading;
            $('#loading').text('Loading ' + loading+'/26 sounds');
            $('#loading-bar').css('width',loadingPercent+'%');
            if(loading==26){
                $('#loading').remove();
                $('#loading-screen').remove();
                $( "body, .bottom-bar" ).addClass('open');
                $( "body" ).addClass('loaded');
            }
        }
  </script>
  <script>
   var timerBottomBar;
			
            $( "body" ).mousemove(function( event ) {
                if(loading==26){
                    $( "body" ).addClass('open');
                    clearTimeout(timerBottomBar);
                    timerBottomBar = setTimeout(function(){
                        $( "body" ).removeClass('open');
                    },2000);
                }
            });
			
			$( document ).keypress(function() {
				$( "#canvas1" ).focus();
			});
  </script>
 </body>
</html>