<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <script src="/CFIDE/scripts/cfform.js" type="text/javascript">
  </script>
  <script src="/CFIDE/scripts/masks.js" type="text/javascript">
  </script>
  <title>
   Securing the Network Time Protocol - ACM Queue
  </title>
  <meta name="description" value="Crackers discover how to use NTP as a weapon for abuse."/>
  <meta name="keywords" value="Networks"/>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <link href="favicon.ico" rel="shortcut icon"/>
  <script src="/js/jquery-1.2.6.min.js" type="text/javascript">
  </script>
  <script src="/js/jquery.validate.min.js" type="text/javascript">
  </script>
  <script src="/js/global.js" type="text/javascript">
  </script>
  <link href="/rss/feeds/latestitems.xml" rel="alternate" title="Latest Queue Content RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/queuecontent.xml" rel="alternate" title="All Queue Content RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/curmudgeon.xml" rel="alternate" title="Curmudgeon RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/opinion.xml" rel="alternate" title="Opinion RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/kodevicious.xml" rel="alternate" title="Kode Vicious RSS 2.0" type="application/rss+xml"/>
  <link href="http://www.infoinc.com/acm/TechNews.rss" rel="alternate" title="ACM TechNews RSS" type="application/rss+xml"/>
  <link href="http://usacm.acm.org/weblog2/?feed=rss2" rel="alternate" title="Washington Updates RSS" type="application/rss+xml"/>
  <link href="/rss/feeds/risksforum.xml" rel="alternate" title="RISKS Forum RSS" type="application/rss+xml"/>
  <link href="/rss/feeds/ai.xml" rel="alternate" title="AI RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/apidesign.xml" rel="alternate" title="API Design RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/bioscience.xml" rel="alternate" title="Bioscience RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/compliance.xml" rel="alternate" title="Compliance RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/componenttechnologies.xml" rel="alternate" title="Component Technologies RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/computerarchitecture.xml" rel="alternate" title="Computer Architecture RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/concurrency.xml" rel="alternate" title="Concurrency RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/dsps.xml" rel="alternate" title="DSPs RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/databases.xml" rel="alternate" title="Databases RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/development.xml" rel="alternate" title="Development RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/distributedcomputing.xml" rel="alternate" title="Distributed Computing RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/distributeddevelopment.xml" rel="alternate" title="Distributed Development RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/education.xml" rel="alternate" title="Education RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/emailandim.xml" rel="alternate" title="Email and IM RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/embeddedsystems.xml" rel="alternate" title="Embedded Systems RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/failureandrecovery.xml" rel="alternate" title="Failure and Recovery RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/filesystemsandstorage.xml" rel="alternate" title="File Systems and Storage RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/gamedevelopment.xml" rel="alternate" title="Game Development RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/graphics.xml" rel="alternate" title="Graphics RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/hci.xml" rel="alternate" title="HCI RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/managingmegaservices.xml" rel="alternate" title="Managing Megaservices RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/mobilecomputing.xml" rel="alternate" title="Mobile Computing RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/networks.xml" rel="alternate" title="Networks RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/object-relationalmapping.xml" rel="alternate" title="Object-Relational Mapping RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/opensource.xml" rel="alternate" title="Open Source RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/patchinganddeployment.xml" rel="alternate" title="Patching and Deployment RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/performance.xml" rel="alternate" title="Performance RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/powermanagement.xml" rel="alternate" title="Power Management RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/privacyandrights.xml" rel="alternate" title="Privacy and Rights RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/processors.xml" rel="alternate" title="Processors RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/programminglanguages.xml" rel="alternate" title="Programming Languages RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/purpose-builtsystems.xml" rel="alternate" title="Purpose-built Systems RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/qualityassurance.xml" rel="alternate" title="Quality Assurance RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/rfid.xml" rel="alternate" title="RFID RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/sip.xml" rel="alternate" title="SIP RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/searchengines.xml" rel="alternate" title="Search Engines RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/security.xml" rel="alternate" title="Security RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/semi-structureddata.xml" rel="alternate" title="Semi-structured Data RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/socialcomputing.xml" rel="alternate" title="Social Computing RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/systemadministration.xml" rel="alternate" title="System Administration RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/systemevolution.xml" rel="alternate" title="System Evolution RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/virtualmachines.xml" rel="alternate" title="Virtual Machines RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/virtualization.xml" rel="alternate" title="Virtualization RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/voip.xml" rel="alternate" title="VoIP RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/webdevelopment.xml" rel="alternate" title="Web Development RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/websecurity.xml" rel="alternate" title="Web Security RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/webservices.xml" rel="alternate" title="Web Services RSS 2.0" type="application/rss+xml"/>
  <link href="/rss/feeds/workflowsystems.xml" rel="alternate" title="Workflow Systems RSS 2.0" type="application/rss+xml"/>
  <script type="text/javascript">
   var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-6562869-1']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
  </script>
  <script type="text/javascript">
   function plusone_vote( obj ) {
_gaq.push(['_trackEvent','plusone',obj.state]);
}
  </script>
  <style>
   body {
	font-family: jaf-bernino-sans, 'Lucida Grande', 'Lucida Sans Unicode', 'Lucida Sans', Geneva, Verdana, sans-serif;
	color: #333;
}
div.container p {
	line-height: 1.65em;
}
h1 {
	font-size: 32px;
}
h3 {
	font-size: 18px;
}
h4 {
	font-size: 14px;
}

div.container {
	margin-left: auto;
	margin-right: auto;
}

div {
	margin: 64px;
	max-width: 640px;
	position: relative;
}
img {
    max-width: 100%;
    height: auto;
    width: auto\9; /* ie8 */
}
a {
	color: #009;
	text-decoration: none;
}
a:hover {
	text-decoration: underline;
}
hr {
	margin:64px;
}
label {
	font-size: 0.8em;
	color: #666;
}
input {
	color: #999;
}

/* NAVBAR */
.navbar {
//	position: fixed;
	background: #EEEEEE;
	top: -64px;
	z-index: 10000;
	width: 100%;
	clear: both;
	padding: 0px;
	margin: 0px;
	padding-top: 10px;
	padding-left: 10px;
	padding-right: 10px;
}

/*  SECTIONS  */
.section {
	clear: both;
	padding: 0px;
	margin: 0px;
}

/*  COLUMN SETUP  */
.col {
	display: block;
	float:left;
	margin: 1% 0 1% 1.6%;
}
.col:first-child { margin-left: 0; }


/*  GROUPING  */
.group:before,
.group:after {
	content:"";
	display:table;
}
.group:after {
	clear:both;
}
.group {
    zoom:1; /* For IE 6/7 */
}

/*  GRID OF THREE  */
.span_3_of_3 {
	width: 100%;
}
.span_2_of_3 {
	width: 66.1%;
}
.span_1_of_3 {
	width: 32.2%;
}

/*  GO FULL WIDTH AT LESS THAN 480 PIXELS */

@media only screen and (max-width: 480px) {
	.col {
		margin: 1% 0 1% 0%;
	}
}

@media only screen and (max-width: 480px) {
	.span_3_of_3 {
		width: 100%;
	}
	.span_2_of_3 {
		width: 100%;
	}
	.span_1_of_3 {
		width: 100%;
	}
}

.span_2_of_2 {
	width: 100%;
}

.span_1_of_2 {
	width: 49.2%;
}

/*  GO FULL WIDTH AT LESS THAN 480 PIXELS */

@media only screen and (max-width: 480px) {
	.span_2_of_2 {
		width: 100%;
	}
	.span_1_of_2 {
		width: 100%;
	}
}
  </style>
  <script src="/cfformprotect/js/mouseMovement.js" type="text/javascript">
  </script>
  <script src="/cfformprotect/js/usedKeyboard.js" type="text/javascript">
  </script>
  <script type="text/javascript">
   &lt;!--
    _CF_checkedit_form = function(_CF_this)
    {
        //reset on submit
        _CF_error_exists = false;
        _CF_error_messages = new Array();
        _CF_error_fields = new Object();
        _CF_FirstErrorField = null;


        //display error messages and return success
        if( _CF_error_exists )
        {
            if( _CF_error_messages.length &gt; 0 )
            {
                // show alert() message
                _CF_onErrorAlert(_CF_error_messages);
                // set focus to first form error, if the field supports js focus().
                if( _CF_this[_CF_FirstErrorField].type == "text" )
                { _CF_this[_CF_FirstErrorField].focus(); }

            }
            return false;
        }else {
            return true;
        }
    }
//--&gt;
  </script>
 </head>
 <body>
  <div class="container">
   <div class="navbar">
    <form action="results.cfm" id="form-search" name="searchform" style="float:right;">
     <input class="text" id="q" name="SearchableText" type="text" value="search"/>
     <br/>
     <a href="issuedetail.cfm?issue=2800695" style="width:150px;font-size:0.7em;">
      Current Issue
     </a>
     <a href="pastissues.cfm" style="width:150px;font-size:0.7em;">
      Past Issues
     </a>
     <a href="topics.cfm" style="width:150px;font-size:0.7em;">
      Topics
     </a>
    </form>
    <a href="/">
     <img src="http://queue.acm.org/img/acmqueue_logo.gif"/>
    </a>
   </div>
   <div style="text-align:center;">
    <a href="http://applicative.acm.org/">
     The talks from the 2015 Applicative conference are now online
    </a>
    <br/>
    <br/>
    <p style="border-bottom:1px solid #C0C2C4;">
    </p>
   </div>
   <br/>
   <h4>
    <a href="/listing.cfm?item_topic=Networks&amp;qc_type=theme_list&amp;filter=Networks&amp;page_title=Networks&amp;order=desc">
     Networks
    </a>
   </h4>
   <p style="float:right;">
    <!-- // Check for existence of associated MP3 file-->
    <a href="http://dl.acm.org/ft_gateway.cfm?id=2717320&amp;ftid=1527214&amp;dwn=1">
     <img alt="Download PDF version of this article" src="img/icon_pdf.png"/>
    </a>
   </p>
   <label>
    January 8, 2015
    <br/>
    <b>
     <a class="descriptor" href="issuedetail.cfm?issue=2716276">
      Volume 13, issue 1
     </a>
    </b>
   </label>
   <h1 class="hidetitle">
    Securing the Network Time Protocol
   </h1>
   <h2>
    Crackers discover how to use NTP as a weapon for abuse.
   </h2>
   <br/>
   <h3>
    Harlan Stenn
   </h3>
   <p>
    In the late 1970s David L. Mills began working on the problem of synchronizing time on networked computers, and NTP (Network Time Protocol) version 1 made its debut in 1980. This was at a time when the net was a much friendlier placethe ARPANET days. NTP version 2 appeared approximately a year later, about the same time as CSNET (Computer Science Network). NSFNET (National Science Foundation Network) launched in 1986. NTP version 3 showed up in 1993.
   </p>
   <p>
    Depending on where you draw the line, the Internet became useful in 1991-1992 and fully arrived in 1995. NTP version 4 appeared in 1997. Now, 17 years later, IETF (Internet Engineering Task Force) is almost done finalizing the NTP version 4 standard, and some of us are starting to think about NTP version 5.
   </p>
   <p>
    All of this is being done by volunteerswith no budget, just by the good graces of companies and individuals who care. This is not a sustainable situation. NTF (Network Time Foundation) is the vehicle that can address this problem, with the support of other organizations and individuals. For example, the Linux Foundation's Core Infrastructure Initiative recently started partially funding two NTP developers: Poul-Henning Kamp for 60 percent of his available time to work on NTP, and me for 30-50 percent of my NTP development work. (Please visit
    <a href="http://nwtime.org/">
     http://nwtime.org/
    </a>
    to see who is supporting Network Time Foundation.)
   </p>
   <p>
    On the public Internet, NTP tends to be visible from three types of machines. One is in embedded systems. When shipped misconfigured by the vendor, these systems have been the direct cause of abuse (
    <a href="http://en.wikipedia.org/wiki/NTP_server_misuse_and_abuse">
     http://en.wikipedia.org/wiki/NTP_server_misuse_and_abuse
    </a>
    ). These systems do not generally support external monitoring, so they are not generally abusable in the context of this article. The second set of machines would be routers, and the majority of the routers that run NTP are from Cisco and Juniper. The third set of machines tend to be Windows machines that run win32time (which does not allow monitoring, and is therefore neither monitorable, nor abusable in this context), and Unix boxes that run NTP, acting as local time servers and distributing time to other machines on the LAN that run NTP to keep the local clock synchronized.
   </p>
   <p>
    For the first 20 years of NTP's history, these local time servers were often old, spare machines that ran a dazzling array of operating systems. Some of these machines kept much better time than others, and people would eventually run them as their master time servers. This is one of the main reasons the NTP codebase stuck with K&amp;R C (named for its authors Brian Kernighan and Dennis Ritchie) for so many years, as that was the only easily available compiler on some of these older machines.
   </p>
   <p>
    It wasn't until December 2006 that NTP upgraded its codebase from K&amp;R C to ANSI C. For a good while, only C89 was required. This was a full six years beyond Y2K, when a lot of these older operating systems were obsolete but still in production. By this time, however, the hardware on which NTP was "easy" to run had changed to x86 gear, and gcc (GNU Compiler Collection) was the easy compiler choice.
   </p>
   <p>
    The NTP codebase does its job very well, is very reliable, and has had an enviable record as far as security problems go. Companies and people often run ancient versions of this software on some embedded systems that effectively never get upgraded and run well enough for a very long time.
   </p>
   <p>
    People just expect accurate time, and they rarely see the consequences of inaccurate time. If the time is wrong, it's often more important to fix it fast and thenmaybesee if the original problem can be identified. The odds of identifying the problem increase if it happens with any frequency. Last year, NTP and our software had an estimated 1
    <i>
     trillion
    </i>
    hours plus of operation. We've received some bug reports over this interval, and we have some open bug reports we would love to resolve, but in spite of this, NTP generally runs very, very well.
   </p>
   <p>
    Having said all of this, I should re-emphasize that NTP made its debut in a much friendlier environment, and that if there was a problem with the time on a machine, it was important to fix the problem as quickly as possible. Over the years, this translated into making it easy for people to query an NTP instance to see what it has been doing. There are two primary reasons for this: one is so it's easy to see if the remote server you want to sync with is configured and behaving adequately; the other is so it's easy to get help from others if there is a problem.
   </p>
   <p>
    While we've been taking steps over the years to make NTP more secure and immune to abuse, the public Internet had more than 7 million abusable NTP servers in the fall of last year. As a result of people upgrading software, fixing configuration files, or because, sadly, some ISPs and IXPs have decided to block NTP traffic, the number of abusable servers has dropped by almost 99 percent in just a few months. This is a remarkably large and fast decline, until you realize that around 85,000 abusable servers still exist, and a DDoS (distributed denial-of-service) attack in the range of 50 to 400 Gbps can be launched using 5,000 servers. There is still a lot of cleanup to be done.
   </p>
   <p>
    One of the best and easiest ways of reducing and even eliminating DDoS attacks is to make sure that computers on
    <i>
     your
    </i>
    networks send packets that come only from
    <i>
     your
    </i>
    IP space. To this end, you should visit
    <a href="http://www.bcp38.info/">
     http://www.bcp38.info/
    </a>
    and take steps to implement this practice for your networks, if you haven't already done so.
   </p>
   <p>
    As I mentioned above, NTP runs on the public Internet in three major places: embedded devices; Unix and some Windows computers; and Cisco and Juniper routers. Before we take a look at how to configure the latter two groups of these so they can't be abused, let's look at the NTP release history.
   </p>
   <p>
   </p>
   <h3>
    NTP Release History
   </h3>
   <p>
    David L. Mills, now a professor emeritus and adjunct professor at the University of Delaware, gave us NTP version 1 in 1980. It was good, and then it got better. A new "experimental" version, xntp2, installed the main binary as xntpd, because, well, that was the easy way to keep the previous version and new version on a box at the same time. Then version 2 became stable and a recommended standard (RFC 1119), so work began on xntp3. But the main program was still installed as xntpd, even though the program wasn't really "experimental." Note that RFC-1305 defines NTPv3, but that standard was never finalized as a recommended standardit remained a draft/elective standard. The RFC for NTPv4 is still in development but is expected to be a full, recommended standard.
   </p>
   <p>
    As for the software release numbering, three of the releases from Mills are xntp3.3wx, xntp3.3wy, and xntp3.5f. These date from just after the time I started using NTP heavily, and I was also sending in portability patches. Back then, you unpacked the tarball, manually edited a config.local file, and did interesting things with the makefile to get the code to build. While Perl's metaconfig was available then and was great for poking around a system, it did not support subdirectory builds and thus could not use a single set of source code for multiple targets.
   </p>
   <p>
    GNU autoconf was still pretty new at that time, and while it did not do nearly as good a job at poking around, it did support subdirectory builds. xntp3.5f was released just as I volunteered to convert the NTP code base to GNU autoconf. As part of that conversion, Mills and I discussed the version numbers, and he was OK with my releasing the first cut of the GNU autoconf code as xntp3-5.80. These were considered alpha releases, as .90 and above were reserved for beta releases. The first production release for this code would be xntp3-6.0, the sixth major release of NTPv3, except that shortly after xntp3-5.93e was released in late November 1993, Mills decided that the NTPv3 code was good enough and that it was time to start on NTPv4.
   </p>
   <p>
    At that point, I noticed that many people had problems with the version-numbering scheme, as the use of both the dash (-) and dot (.) characters really confused people. So ntp-4.0.94a was the first beta release of the NTPv4 code in July 1997. The release numbers went from ntpPROTO-Maj.Min to ntp-PROTO.Maj.Min.
   </p>
   <p>
    While this change had the desired effect of removing confusion about how to type the version number, it meant that most people didn't realize that going from ntp-4.1.x to 4.2.x was a
    <strong>
     <i>
      major
     </i>
    </strong>
    release upgrade. People also didn't seem to understand just how many items were being fixed or improved in minor releases. For more information about this, see table 1.
   </p>
   <img alt="Securing the Network Time Protocol: NTP Release History" src="http://deliveryimages.acm.org/10.1145/2720000/2717320/stenn1.png"/>
   <p>
    At one point I tried going back to a version-numbering scheme that was closer to the previous method, but I got a lot of pushback so I didn't go through with it. In hindsight, I should have stood my ground. Having seen how people don't appreciate the significance of the releasesmajor or minorwe will go back to a numbering scheme much closer to the original after 4.2.8 is released. The major release after ntp-4.2.8 will be ntp4-5.0.0, or ntpPROTO-Maj.Min.Point. (Our source archives reveal how the release numbering choices have evolved over the years, and how badly some of them collated.)
   </p>
   <p>
   </p>
   <h3>
    Securing NTP
   </h3>
   <p>
    Before we delve into how to secure NTP, I recommend you listen to Dan Geer's keynote speech for Blackhat 2014, if you have not already done so (
    <a href="https://www.youtube.com/watch?v=nT-TGvYOBpI">
     https://www.youtube.com/watch?v=nT-TGvYOBpI
    </a>
    ). It will be an excellent use of an hour of your time. If you watch it and disagree with what he says, then I wonder why you're reading this document to look for a solution to NTP abuse vector problems.
   </p>
   <p>
    Now, to secure NTP, first implement BCP38 (
    <a href="http://www.bcp38.info/">
     http://www.bcp38.info
    </a>
    ). It's not that hard.
   </p>
   <p>
    If you want to make sure that NTP on your Cisco or Juniper routers is protected, then consult their documentation on how to do so. You will find lots of good discussions and articles on the Web with additional updated information, and I recommend
    <a href="http://www.team-cymru.org/ReadingRoom/Templates/secure-ntp-template.html">
     http://www.team-cymru.org/ReadingRoom/Templates/secure-ntp-template.html
    </a>
    for information about securing NTP on Cisco and Juniper routers.
   </p>
   <p>
    The NTP support site provides information on how to secure NTP through the ntp.conf file. Find some discussion and a link to that site at
    <a href="http://nwtime.org/ntp-winter-2013-network-drdos-attacks/">
     http://nwtime.org/ntp-winter-2013-network-drdos-attacks/
    </a>
    . NTF is also garnering the resources to produce an online ntp.conf generator that will implement BCP for this file and make it easy to update that file as our codebase and knowledge evolve.
   </p>
   <p>
    That said, the most significant NTP abuse vectors are disabled by default starting with ntp-4.2.7p27, and these and other improvements will be in ntp-4.2.8, which was released at the end of 2014.
   </p>
   <p>
    For versions 4.2.6 through 4.2.7p27, this abuse vector can be prevented by adding the following to your ntp.conf file:
   </p>
   <p>
    <tt>
     restrict default ... noquery ...
    </tt>
   </p>
   <p>
   </p>
   <p>
    Note well that if you have additional
    <tt>
     restrict
    </tt>
    lines for IPs or networks that do
    <i>
     not
    </i>
    include the
    <tt>
     noquery
    </tt>
    restriction, ask yourself whether it's possible for those IPs to be spoofed...
   </p>
   <p>
    For version 4.2.4, which was released in December 2006 and EOLed (brought to the end-of-life) in December 2009, consider the following:
   </p>
   <p>
     You didn't pay attention to what Dan Geer said.
   </p>
   <p>
     Did you notice that we fixed 630-1,000 issues going from 4.2.4 to 4.2.6?
   </p>
   <p>
     Are you still interested in running 4.2.4? Do you really have a good reason for this?
   </p>
   <p>
    If so, add to your ntp.conf file:
   </p>
   <p>
    <tt>
     restrict default ... noquery ...
    </tt>
   </p>
   <p>
   </p>
   <p>
    For version 4.2.2, which was released in June 2006 and EOLed in December 2006:
   </p>
   <p>
     You didn't pay attention to what Dan Geer said.
   </p>
   <p>
     Did you notice that we fixed about 450 issues going from 4.2.2 to 4.2.4, and 630-1,000 issues going from 4.2.4 to 4.2.6? That's between 1,000 and 1,500 issues. Seriously.
   </p>
   <p>
     Are you still interested in running 4.2.2? Do you really have a good reason for this?
   </p>
   <p>
    If so, add to your ntp.conf file:
   </p>
   <p>
    <tt>
     restrict default ... noquery ...
    </tt>
   </p>
   <p>
   </p>
   <p>
    For version 4.2.0, which was released in 2003 and EOLed in 2006:
   </p>
   <p>
     You didn't pay attention to what Dan Geer said.
   </p>
   <p>
     Did you notice that we fixed about 560 issues going from 4.2.0 to 4.2.2, 450 issues going from 4.2.2 to 4.2.4, and 630-1,000 issues going from 4.2.4 to 4.2.6? That's between 1,500 and 2,000 issues. Seriously.
   </p>
   <p>
     Are you still interested in running 4.2.2? Do you really have a good reason for this?
   </p>
   <p>
    If so, add to your ntp.conf file:
   </p>
   <p>
    <tt>
     restrict default ... noquery ...
    </tt>
   </p>
   <p>
   </p>
   <p>
    For versions 4.0 through 4.1.1, which were released and EOLed somewhere around 2001 to 2003, no numbers exist for how many issues were fixed in these releases:
   </p>
   <p>
     You didn't pay attention to what Dan Geer said.
   </p>
   <p>
     There are probably in excess of 2,000-2,500 issues fixed since then.
   </p>
   <p>
     Are you still interested in running 4.0 or 4.1 code? Do you really have a good reason for this?
   </p>
   <p>
    If so, add to your ntp.conf file:
   </p>
   <p>
    <tt>
     restrict default ... noquery ...
    </tt>
   </p>
   <p>
   </p>
   <p>
    Now let's talk about xntp3, which was EOLed in September 1997. Do the math on how old that is, take a guess at how many issues have been fixed since then, and ask yourself and anybody else who has a voice in the matter: why are you running software that was EOLed 17 years ago, when thousands of issues have been fixed and an improved protocol has been implemented since then?
   </p>
   <p>
    If your answer is: "Because NTPv3 was a standard and NTPv4 is not yet a standard," then I have bad news for you. NTPv3 was
    <strong>
     <i>
      not
     </i>
    </strong>
    a recommended standard; it was only a draft/elective standard. If you
    <strong>
     really
    </strong>
    want to run only officially standard software, you can drop back to NTPv2and I don't know anybody who would want to do that.
   </p>
   <p>
    If your answer is: "We're not sure how stable NTPv4 is," then I'll point out that NTPv4 has an estimated 5-10
    <i>
     trillion
    </i>
    operational hours at this point. How much more do you want?
   </p>
   <p>
    But if you insist, the way to secure xntp2 and xntp3 against the described abuse vector is to add to your ntp.conf file:
   </p>
   <p>
    <tt>
     restrict default ... noquery ...
    </tt>
   </p>
   <p>
   </p>
   <p>
    LOVE IT, HATE IT? LET US KNOW
   </p>
   <p>
    feedback@queue.acm.org
   </p>
   <p>
    <b>
     Harlan Stenn
    </b>
    learned programming on a PDP-8/S (mostly FOCAL and assembler), which had 4 KB of real core memory, at about the same time he learned to drive a car. While helping other companies write and maintain portable Unix software, he discovered the need for synchronized time (to build software stored on NFS file systems), which led him to "timed" and "ntp." He started submitting NTP patches to David Mills, which led to his converting the NTP codebase to use GNU Autoconf for its build system. Then he became NTP's release engineer and bugfix integrator. From there, he became the NTP project manager. Watching the inability of the volunteer crew to keep up with the increasing workload, he founded Network Time Foundation in 2011, a public benefit company with a mission to improve the state of computer network timekeeping, working to support NTP (Network Time Protocol), PTP (Precision Time Protocol), and other time-related projects.
   </p>
   <p>
     2014 ACM 1542-7730/14/1200 $10.00
   </p>
   <h4>
    See Also
   </h4>
   <p>
    <b>
     <a href="http://queue.acm.org/detail.cfm?id=1773943">
      Principles of Robust Timing over the Internet
     </a>
    </b>
    <br/>
    The key to synchronizing clocks over networks is taming delay variability.
    <br/>
    - Julien Ridoux and Darryl Veitch
    <br/>
    Everyone, and most everything, needs a clock, and computers are no exception. Clocks tend to drift off if left to themselves, however, so it is necessary to bring them to heel periodically through synchronizing to some other reference clock of higher accuracy. An inexpensive and convenient way to do this is over a computer network.
   </p>
   <p>
    <b>
     <a href="http://queue.acm.org/detail.cfm?id=2354406">
      Toward Higher Precision
     </a>
    </b>
    <br/>
    An introduction to PTP and its significance to NTP practitioners
    <br/>
    - Rick Ratzel and Rodney Greenstreet
    <br/>
    It is difficult to overstate the importance of synchronized time to modern computer systems. Our lives today depend on the financial transactions, telecommunications, power generation and delivery, high-speed manufacturing, and discoveries in "big physics," among many other things, that are driven by fast, powerful computing devices coordinated in time with each other.
   </p>
   <p>
    <b>
     <a href="http://queue.acm.org/detail.cfm?id=1967009">
      The One-second War (What Time Will You Die?)
     </a>
    </b>
    <br/>
    As more and more systems care about time at the second and sub-second level, finding a lasting solution to the leap seconds problem is becoming increasingly urgent.
    <br/>
    - Poul-Henning Kamp
    <br/>
    Thanks to a secretive conspiracy working mostly below the public radar, your time of death may be a minute later than presently expected. But don't expect to live any longer, unless you happen to be responsible for time synchronization in a large network of computers, in which case this coup will lower your stress level a bit every other year or so.
   </p>
   <p>
    <img alt="acmqueue" class="floatLeft" height="45" src="img/q stamp_small.jpg" width="26"/>
    <br/>
    <br/>
    <em>
     Originally published in Queue vol. 13, no. 1
    </em>
    
    <br/>
    see this item in the
    <a href="http://portal.acm.org/citation.cfm?id=2717320">
     ACM Digital Library
    </a>
   </p>
   <br/>
   <a class="twitter-share-button" data-via="ACMQueue" href="https://twitter.com/share">
    Tweet
   </a>
   <script>
    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
   </script>
   <br/>
   <fb:like>
   </fb:like>
   <br/>
   <div class="g-plusone" data-annotation="inline" data-size="small" data-width="120">
   </div>
   <!-- these get hooked up to js events -->
   <script type="text/javascript">
    addthis_pub             = 'acm';
	addthis_logo            = 'http://queue.acm.org/img/logo_queue_small.gif';
	addthis_logo_background = '#ffffff';
	addthis_logo_color      = '000000';
	addthis_brand           = 'ACM Queue';
	addthis_options         = 'reddit, slashdot, facebook, favorites, email, delicious, digg, technorati, blinklist, furl, myspace, google, live, more';
   </script>
   <!-- FB Like -->
   <div id="fb-root">
   </div>
   <script>
    (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
   </script>
   <div id="fb-root">
   </div>
   <!-- Place this tag after the last +1 button tag. -->
   <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
   </script>
   <br/>
   <script src="http://connect.facebook.net/en_US/all.js#xfbml=1">
   </script>
   <script>
    FB.Event.subscribe('edge.create', function(targetUrl) {
  _gaq.push(['_trackSocial', 'facebook', 'like', targetUrl]);
});
   </script>
   <!-- EMail Link-->
   <hr noshade="" size="1"/>
   Related:
   <p>
    <span>
     Peter Bailis, Kyle Kingsbury
    </span>
    -
    <a href="detail.cfm?id=2655736">
     <b>
      The Network is Reliable
     </b>
    </a>
    <br/>
    An informal survey of real-world communications failures
   </p>
   <br/>
   <p>
    <span>
     Christoph Paasch, Olivier Bonaventure
    </span>
    -
    <a href="detail.cfm?id=2591369">
     <b>
      Multipath TCP
     </b>
    </a>
    <br/>
    Decoupled from IP, TCP is at last able to support multihomed hosts.
   </p>
   <br/>
   <p>
    <span>
     Nick Feamster, Jennifer Rexford, Ellen Zegura
    </span>
    -
    <a href="detail.cfm?id=2560327">
     <b>
      The Road to SDN
     </b>
    </a>
    <br/>
    An intellectual history of programmable networks
   </p>
   <br/>
   <p>
    <span>
     Stephen D. Strowes
    </span>
    -
    <a href="detail.cfm?id=2539132">
     <b>
      Passively Measuring TCP Round-trip Times
     </b>
    </a>
    <br/>
    A close look at RTT measurements with TCP
   </p>
   <br/>
   <hr noshade="" size="1"/>
   <h3>
    Comments
   </h3>
   <form action="postcomment.cfm" id="edit_form" method="post" name="edit_form" onsubmit="return _CF_checkedit_form(this)">
    <input id="formfield1234567891" name="formfield1234567891" type="hidden" value=""/>
    <input id="formfield1234567892" name="formfield1234567892" type="hidden" value=""/>
    <input name="formfield1234567893" type="hidden" value="39890920,19894706"/>
    <span style="display:none">
     Leave this field empty
     <input name="formfield1234567894" type="text" value=""/>
    </span>
   </form>
   <form action="postcomment.cfm" id="edit_form" method="post" name="edit_form" onsubmit="return ColdFusion.Ajax.checkForm(this, _CF_checkedit_form,'cf_layoutarea1411408071716')">
    <input name="id" type="Hidden" value="2717320"/>
    <p>
     Post a Comment:
    </p>
    <input alt="Submitter" id="username" name="Creator" onfocus="if (this.value == 'name') {this.value = '';}" size="40" title="Name" type="text" value="name"/>
    <br/>
    <input id="email" name="email" onfocus="if (this.value == 'email') {this.value = '';}" size="40" type="text" value="email"/>
    <br/>
    <label for="body_text">
     Comment: (Required - 4,000 character limit - HTML syntax is
     <strong>
      not
     </strong>
     allowed and
     <b>
      will be removed
     </b>
     )
    </label>
    <br/>
    <textarea cols="80" html="No" id="body_text" name="body_text" rows="8">
    </textarea>
    <br/>
    <input class="context" id="discussion_reply:method" name="discussion_reply:method" type="submit" validate="SubmitOnce" value="Post"/>
   </form>
   <hr noshade="" size="1"/>
   <p>
    <a href="#">
     <img src="http://queuedev.acm.org/img/logo_acm.gif"/>
    </a>
    <br/>
     2014 ACM, Inc. All Rights Reserved.
   </p>
  </div>
 </body>
</html>